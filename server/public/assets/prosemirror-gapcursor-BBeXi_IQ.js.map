{"version":3,"file":"prosemirror-gapcursor-BBeXi_IQ.js","sources":["../../node_modules/prosemirror-gapcursor/dist/index.js"],"sourcesContent":["import { keydownHandler } from 'prosemirror-keymap';\nimport { Selection, NodeSelection, TextSelection, Plugin } from 'prosemirror-state';\nimport { Slice, Fragment } from 'prosemirror-model';\nimport { DecorationSet, Decoration } from 'prosemirror-view';\n\n/**\nGap cursor selections are represented using this class. Its\n`$anchor` and `$head` properties both point at the cursor position.\n*/\nclass GapCursor extends Selection {\n    /**\n    Create a gap cursor.\n    */\n    constructor($pos) {\n        super($pos, $pos);\n    }\n    map(doc, mapping) {\n        let $pos = doc.resolve(mapping.map(this.head));\n        return GapCursor.valid($pos) ? new GapCursor($pos) : Selection.near($pos);\n    }\n    content() { return Slice.empty; }\n    eq(other) {\n        return other instanceof GapCursor && other.head == this.head;\n    }\n    toJSON() {\n        return { type: \"gapcursor\", pos: this.head };\n    }\n    /**\n    @internal\n    */\n    static fromJSON(doc, json) {\n        if (typeof json.pos != \"number\")\n            throw new RangeError(\"Invalid input for GapCursor.fromJSON\");\n        return new GapCursor(doc.resolve(json.pos));\n    }\n    /**\n    @internal\n    */\n    getBookmark() { return new GapBookmark(this.anchor); }\n    /**\n    @internal\n    */\n    static valid($pos) {\n        let parent = $pos.parent;\n        if (parent.isTextblock || !closedBefore($pos) || !closedAfter($pos))\n            return false;\n        let override = parent.type.spec.allowGapCursor;\n        if (override != null)\n            return override;\n        let deflt = parent.contentMatchAt($pos.index()).defaultType;\n        return deflt && deflt.isTextblock;\n    }\n    /**\n    @internal\n    */\n    static findGapCursorFrom($pos, dir, mustMove = false) {\n        search: for (;;) {\n            if (!mustMove && GapCursor.valid($pos))\n                return $pos;\n            let pos = $pos.pos, next = null;\n            // Scan up from this position\n            for (let d = $pos.depth;; d--) {\n                let parent = $pos.node(d);\n                if (dir > 0 ? $pos.indexAfter(d) < parent.childCount : $pos.index(d) > 0) {\n                    next = parent.child(dir > 0 ? $pos.indexAfter(d) : $pos.index(d) - 1);\n                    break;\n                }\n                else if (d == 0) {\n                    return null;\n                }\n                pos += dir;\n                let $cur = $pos.doc.resolve(pos);\n                if (GapCursor.valid($cur))\n                    return $cur;\n            }\n            // And then down into the next node\n            for (;;) {\n                let inside = dir > 0 ? next.firstChild : next.lastChild;\n                if (!inside) {\n                    if (next.isAtom && !next.isText && !NodeSelection.isSelectable(next)) {\n                        $pos = $pos.doc.resolve(pos + next.nodeSize * dir);\n                        mustMove = false;\n                        continue search;\n                    }\n                    break;\n                }\n                next = inside;\n                pos += dir;\n                let $cur = $pos.doc.resolve(pos);\n                if (GapCursor.valid($cur))\n                    return $cur;\n            }\n            return null;\n        }\n    }\n}\nGapCursor.prototype.visible = false;\nGapCursor.findFrom = GapCursor.findGapCursorFrom;\nSelection.jsonID(\"gapcursor\", GapCursor);\nclass GapBookmark {\n    constructor(pos) {\n        this.pos = pos;\n    }\n    map(mapping) {\n        return new GapBookmark(mapping.map(this.pos));\n    }\n    resolve(doc) {\n        let $pos = doc.resolve(this.pos);\n        return GapCursor.valid($pos) ? new GapCursor($pos) : Selection.near($pos);\n    }\n}\nfunction closedBefore($pos) {\n    for (let d = $pos.depth; d >= 0; d--) {\n        let index = $pos.index(d), parent = $pos.node(d);\n        // At the start of this parent, look at next one\n        if (index == 0) {\n            if (parent.type.spec.isolating)\n                return true;\n            continue;\n        }\n        // See if the node before (or its first ancestor) is closed\n        for (let before = parent.child(index - 1);; before = before.lastChild) {\n            if ((before.childCount == 0 && !before.inlineContent) || before.isAtom || before.type.spec.isolating)\n                return true;\n            if (before.inlineContent)\n                return false;\n        }\n    }\n    // Hit start of document\n    return true;\n}\nfunction closedAfter($pos) {\n    for (let d = $pos.depth; d >= 0; d--) {\n        let index = $pos.indexAfter(d), parent = $pos.node(d);\n        if (index == parent.childCount) {\n            if (parent.type.spec.isolating)\n                return true;\n            continue;\n        }\n        for (let after = parent.child(index);; after = after.firstChild) {\n            if ((after.childCount == 0 && !after.inlineContent) || after.isAtom || after.type.spec.isolating)\n                return true;\n            if (after.inlineContent)\n                return false;\n        }\n    }\n    return true;\n}\n\n/**\nCreate a gap cursor plugin. When enabled, this will capture clicks\nnear and arrow-key-motion past places that don't have a normally\nselectable position nearby, and create a gap cursor selection for\nthem. The cursor is drawn as an element with class\n`ProseMirror-gapcursor`. You can either include\n`style/gapcursor.css` from the package's directory or add your own\nstyles to make it visible.\n*/\nfunction gapCursor() {\n    return new Plugin({\n        props: {\n            decorations: drawGapCursor,\n            createSelectionBetween(_view, $anchor, $head) {\n                return $anchor.pos == $head.pos && GapCursor.valid($head) ? new GapCursor($head) : null;\n            },\n            handleClick,\n            handleKeyDown,\n            handleDOMEvents: { beforeinput: beforeinput }\n        }\n    });\n}\nconst handleKeyDown = keydownHandler({\n    \"ArrowLeft\": arrow(\"horiz\", -1),\n    \"ArrowRight\": arrow(\"horiz\", 1),\n    \"ArrowUp\": arrow(\"vert\", -1),\n    \"ArrowDown\": arrow(\"vert\", 1)\n});\nfunction arrow(axis, dir) {\n    const dirStr = axis == \"vert\" ? (dir > 0 ? \"down\" : \"up\") : (dir > 0 ? \"right\" : \"left\");\n    return function (state, dispatch, view) {\n        let sel = state.selection;\n        let $start = dir > 0 ? sel.$to : sel.$from, mustMove = sel.empty;\n        if (sel instanceof TextSelection) {\n            if (!view.endOfTextblock(dirStr) || $start.depth == 0)\n                return false;\n            mustMove = false;\n            $start = state.doc.resolve(dir > 0 ? $start.after() : $start.before());\n        }\n        let $found = GapCursor.findGapCursorFrom($start, dir, mustMove);\n        if (!$found)\n            return false;\n        if (dispatch)\n            dispatch(state.tr.setSelection(new GapCursor($found)));\n        return true;\n    };\n}\nfunction handleClick(view, pos, event) {\n    if (!view || !view.editable)\n        return false;\n    let $pos = view.state.doc.resolve(pos);\n    if (!GapCursor.valid($pos))\n        return false;\n    let clickPos = view.posAtCoords({ left: event.clientX, top: event.clientY });\n    if (clickPos && clickPos.inside > -1 && NodeSelection.isSelectable(view.state.doc.nodeAt(clickPos.inside)))\n        return false;\n    view.dispatch(view.state.tr.setSelection(new GapCursor($pos)));\n    return true;\n}\n// This is a hack that, when a composition starts while a gap cursor\n// is active, quickly creates an inline context for the composition to\n// happen in, to avoid it being aborted by the DOM selection being\n// moved into a valid position.\nfunction beforeinput(view, event) {\n    if (event.inputType != \"insertCompositionText\" || !(view.state.selection instanceof GapCursor))\n        return false;\n    let { $from } = view.state.selection;\n    let insert = $from.parent.contentMatchAt($from.index()).findWrapping(view.state.schema.nodes.text);\n    if (!insert)\n        return false;\n    let frag = Fragment.empty;\n    for (let i = insert.length - 1; i >= 0; i--)\n        frag = Fragment.from(insert[i].createAndFill(null, frag));\n    let tr = view.state.tr.replace($from.pos, $from.pos, new Slice(frag, 0, 0));\n    tr.setSelection(TextSelection.near(tr.doc.resolve($from.pos + 1)));\n    view.dispatch(tr);\n    return false;\n}\nfunction drawGapCursor(state) {\n    if (!(state.selection instanceof GapCursor))\n        return null;\n    let node = document.createElement(\"div\");\n    node.className = \"ProseMirror-gapcursor\";\n    return DecorationSet.create(state.doc, [Decoration.widget(state.selection.head, node, { key: \"gapcursor\" })]);\n}\n\nexport { GapCursor, gapCursor };\n"],"names":["GapCursor","Selection","$pos","doc","mapping","Slice","other","json","GapBookmark","parent","closedBefore","closedAfter","override","deflt","dir","mustMove","search","pos","next","d","$cur","inside","NodeSelection","index","before","after","gapCursor","Plugin","drawGapCursor","_view","$anchor","$head","handleClick","handleKeyDown","beforeinput","keydownHandler","arrow","axis","dirStr","state","dispatch","view","sel","$start","TextSelection","$found","event","clickPos","$from","insert","frag","Fragment","i","tr","node","DecorationSet","Decoration"],"mappings":"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","x_google_ignoreList":[0]}