import{r as i,j as e}from"./react-CFyJEAuc.js";import{i as wn}from"./i18next-CO45VQzB.js";import{i as Cn,u as L}from"./react-i18next-m5toO21s.js";import{R as Sn}from"./react-dom-DiGrC_4W.js";import{H as kn,a as ie}from"./react-helmet-async-C7lQZXof.js";import{P as d}from"./prop-types-C6oFCY0U.js";import{u as De,L as $n,a as Ee,b as Pn,O as Fn,N as rt,B as Rn}from"./react-router-B-PzIy_Z.js";import{u as je,a as Ce,B as O,S as $,T as P,s as Ie,b as E,A as pe,c as Y,D as ae,L as vt,C as Tn,F as Ae,d as te,I as We,e as H,M as W,f as Ve,g as ne,P as _e,h as Se,i as xe,j as On,k as Je,l as ot,m as it,n as Dn,o as En,p as wt,q as In,r as An,t as Nn,v as Ln,w as le,x as Ke,y as Un,z as he,G as X,E as Te,H as Bn,J as Ne,K as Z,N as Mn,O as me,Q as Wn,R as zn,U as qn,V as Hn,W as Gn,X as Vn,Y as Jn,Z as Kn,_ as Yn,$ as at,a0 as ke,a1 as Zn,a2 as Xn,a3 as Qn,a4 as es,a5 as lt,a6 as ts,a7 as $e}from"./@mui-Dcuc591Q.js";import{f as Ye,a as ns,b as ss,e as ct,c as rs,d as os}from"./date-fns-BGICL5-d.js";import{n as is}from"./numeral-MI4i5EM7.js";import{A as Ze}from"./react-apexcharts-D-_s-s_p.js";import{C as as}from"./react-material-ui-carousel-CS9XfEsu.js";import{T as ls,a as dt}from"./mui-tiptap-editor-BOU4kAcX.js";import"./@emotion-CqV0AzBE.js";import{i as Ct,d as cs}from"./lodash-4lwYQPXq.js";import{w as ds}from"./websocket-XZy_nFgd.js";import{c as us}from"./sha256-uint8array-DNUmUZDr.js";import{I as ps}from"./@iconify-CHzKCzOs.js";import{S as hs}from"./mui-color-input-M8MIX8Iy.js";import{S as xs}from"./simplebar-react-BvwG2ii2.js";import"./index-pfyqZ81J.js";import"./scheduler-SPyfQU6S.js";import"./react-fast-compare-BpcXi7xd.js";import"./invariant-Cni9POrp.js";import"./shallowequal-wfPe1HzH.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-BpTLEanp.js";import"./@babel-B5c2X20U.js";import"./@popperjs-B_2vCoY7.js";import"./react-is-BPJnJB5S.js";import"./apexcharts-C3Y1NT8T.js";import"./framer-motion-BbHstrI0.js";import"./tslib-Cl2D6AzD.js";import"./hey-listen--dyuUo0b.js";import"./style-value-types-BAfJXZRZ.js";import"./popmotion-D6DFATwb.js";import"./framesync-BEUTIEb0.js";import"./@tiptap-CFbbXN2V.js";import"./prosemirror-state-ChlmXDrH.js";import"./prosemirror-model-BeEvkDM6.js";import"./orderedmap-C4TimWWB.js";import"./prosemirror-transform-2Ouwqz82.js";import"./tippy.js-T2NbCdtq.js";import"./linkifyjs-D1E_6M9a.js";import"./prosemirror-view-BDCVSZTi.js";import"./prosemirror-tables-B9Tm3w7H.js";import"./prosemirror-keymap-DL2ZCKxC.js";import"./w3c-keyname-DEtA-KhA.js";import"./prosemirror-dropcursor-DSn0vDGy.js";import"./prosemirror-gapcursor-BBeXi_IQ.js";import"./prosemirror-history-DJ2E3SMw.js";import"./rope-sequence-Cxv9J64N.js";import"./prosemirror-commands-Cj2ZrUhE.js";import"./prosemirror-schema-list-DJgnbLu-.js";import"./lowlight-HkzL583q.js";import"./highlight.js-DzbieIK9.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-BqmD5Vow.js";import"./es5-ext-B-aRoSt4.js";import"./simplebar-core-Dgrngn7n.js";import"./lodash-es-BFDc8I3u.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();var si=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ri(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function oi(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var n=t.default;if(typeof n=="function"){var s=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};s.prototype=n.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(s,r,o.get?o:{enumerable:!0,get:function(){return t[r]}})}),s}const gs={English:"English",Spanish:"Spanish",German:"German",_consumption_:"Current Consumption",_perShelly_:"per Shelly",Running:"Running",Connected:"Connected",_welcome_:"Welcome back 游녦",Filters:"Filters",_sortby_:"Sort by",Submit:"Submit",Clear:"Clear",Alias:"Alias",Model:"Model",Generation:"Generation",_byminute_:"By Minute",_byhour_:"By Hour",_byday_:"By Day",_bymonth_:"By Month",_byyear_:"By Year",_notconnected_:"Disconnected!",_getinvolved_:"Get involved!",_gotogithub_:"Go to Github",_opensource_:"Open Source AGPL License",Home:"Home",Profile:"Profile",Security:"Security",Settings:"Settings",Logout:"Logout",_forgotpw_:"Forgot Password?",_wrongpw_:"Wrong Password!",_usernotexists_:"EMail not found!",_resetpw_:"Password was reset.",Password:"Password",Email:"Email",Firstname:"Firstname",Lastname:"Lastname",Role:"Role",_newuser_:"New User",_editprofile_:"Your Profile",_edituserprofile_:"Edit User",_editsecurity_:"Your Access",_editsettings:"Your Settings",_searchuser_:"Search User",Users:"Users",_rowsperpage_:"Rows per page:",of:"of",_morethan_:"more than",Login:"Login",Save:"Save",_userupdated_:"User was updated",_usernotupdated_:"Could not update user",_usercreated_:"User was created",_usernotcreated_:"Could not create user",_blogpostcreated_:"Post was saved",_blogpostnotcreated_:"Could not save post",_blogpostupdated_:"Post was updated",_blogpostnotupdated_:"Could not update post",Delete:"Delete",Edit:"Edit",_reallydelete_:"Really Delete?",_userdeleted_:"User deleted",_usernotdeleted:"Couldn't delete user",_emailexists_:"Email already exists",_aliasexists_:"Alias already exists",Read:"Read",Unread:"Unread",Notifications:"Notifications",_unreadmessages_:"You have {{totalUnRead}} new messages",_markallasread_:"Mark all as read",Brightness:"Brightness",White:"White",Control:"Controls",_newpost_:"New Post",Title:"Title",Content:"Content",_editpost_:"Edit Post","_editor-preview_":"Preview","_editor-bold_":"Bold","_editor-italic_":"Italic","_editor-strike_":"Strikethrough","_editor-underline_":"Underline","_editor-link_":"Link","_editor-bulletlist_":"Bullet List","_editor-orderedlist_":"Ordered List","_editor-alignleft_":"Align left","_editor-aligncenter_":"Align Center","_editor-alignright_":"Align Right","_editor-alignjustify_":"Align Justify","_editor-blockquote_":"Blockquote","_editor-codeblock_":"Codeblock","_editor-undo_":"Undo","_editor-redo_":"Redo","_editor-normaltext_":"Normal","_editor-h1_":"Heading1","_editor-h2_":"Heading2","_editor-h3_":"Heading3","_editor-h4_":"Heading4","_editor-h5_":"Heading5","_editor-h6_":"Heading6","_editor-insertlink_":"Insert Link","_editor-invalidlink_":"Invalid Link","_editor-color_":"Text Color","_editor-placeholder_":"Write your post",_notfound_:"Not found",_noresultsfor_:"No results found for",selected:"selected",_assigndevices_:"Shelly assingment",_devicesupdated_:"Assignment saved",_devicesnotupdated:"Error saving Assignment"},fs={translation:gs},ms={English:"Englisch",Spanish:"Spanisch",German:"Deutsch",_consumption_:"Aktueller Verbrauch",_perShelly_:"per Shelly",Running:"Laufen",Connected:"Verbunden",_welcome_:"Willkommen zur칲ck 游녦",Filters:"Filter",_sortby_:"Sortierung",Submit:"Anwenden",Clear:"L칬schen",Alias:"Alias",Model:"Model",Generation:"Generation",_byminute_:"Per Minute",_byhour_:"Per Stunde",_byday_:"Per Tag",_bymonth_:"Per Monat",_byyear_:"Per Jahr",_notconnected_:"Getrennt!",_getinvolved_:"Helf mit!",_gotogithub_:"Besuch das Github Projekt",_opensource_:"Open Source AGPL Lizenz",Home:"Home",Profile:"Profil",Security:"Sicherheit",Settings:"Einstellungen",Logout:"Logout",_forgotpw_:"Passwort vergessen?",_wrongpw_:"Falsches Passwort!",_usernotexists_:"Email nicht gefunden!",_resetpw_:"Passwort wurde zur칲ck gesetzt.",Password:"Passwort",Email:"Email",Firstname:"Vorname",Lastname:"Nachname",Role:"Rolle",_newuser_:"Neuer Benutzer",_editprofile_:"Dein Profil",_edituserprofile_:"Benutzer bearbeiten",_editsecurity_:"Deine Zugangsdaten",_editsettings:"Deine Einstellungen",_searchuser_:"Benutzer suchen",Users:"Benutzer",_rowsperpage_:"Zeilen per Seite:",of:"von",_morethan_:"mehr als",Login:"Anmelden",Save:"Speichern",_userupdated_:"User aktualisiert",_usernotupdated_:"Fehler bei der Aktualisierung ",_usercreated_:"Benutzer wurde angelegt",_usernotcreated_:"Benutzer konnte nicht angelegt werden",_blogpostcreated_:"Post wurde gespeichert",_blogpostnotcreated_:"Post konnte nicht gespeichert werden",_blogpostupdated_:"Post wurde aktualisiert",_blogpostnotupdated_:"Fehler bei der Aktualisierung",Delete:"L칬schen",Edit:"Bearbeiten",_reallydelete_:"Wirklich L칬schen?",_userdeleted_:"Benutzer wurde gel칬scht",_usernotdeleted:"Benutzer konnte nicht gel칬scht werden",_emailexists_:"Email existiert bereits",_aliasexists_:"Alias existiert bereits",Read:"Gelesen",Unread:"Ungelesen",Notifications:"Nachrichten",_unreadmessages_:"Du hast {{totalUnRead}} neue Meldungen",_markallasread_:"Alle als gelesen markieren",Brightness:"Helligkeit",White:"Wei",Control:"Einstellung",_newpost_:"Neuer Post",Title:"Titel",Content:"Inhalt",_editpost_:"Post bearbeiten","_editor-preview_":"Vorschau","_editor-bold_":"Fett","_editor-italic_":"Kursiv","_editor-strike_":"Durchgestrichen","_editor-underline_":"Unterstrichen","_editor-link_":"Link","_editor-bulletlist_":"Aufz칛hlung","_editor-orderedlist_":"Numerierung","_editor-alignleft_":"Links Ausrichten","_editor-aligncenter_":"Mittig Ausrichten","_editor-alignright_":"Rechts Ausrichten","_editor-alignjustify_":"Gleichm칛ig Ausrichten","_editor-blockquote_":"Zitat","_editor-codeblock_":"Codeblock","_editor-undo_":"Zur칲ck","_editor-redo_":"Wiederherstellen","_editor-normaltext_":"Normal","_editor-h1_":"칖berschrift1","_editor-h2_":"칖berschrift2","_editor-h3_":"칖berschrift3","_editor-h4_":"칖berschrift4","_editor-h5_":"칖berschrift5","_editor-h6_":"칖berschrift6","_editor-insertlink_":"Link Einf칲gen","_editor-invalidlink_":"Ung칲ltiger Link","_editor-color_":"Textfarbe","_editor-placeholder_":"Schreib deinen Post",_notfound_:"Nicht gefunden",_noresultsfor_:"Keine Resultate gefunden f칲r",selected:"ausgew칛hlt",_assigndevices_:"Shelly zuordnen",_devicesupdated_:"Zuordnung gespeichert",_devicesnotupdated:"Fehler bei der Zuordnung"},bs={translation:ms},js={English:"Ingl칠s",Spanish:"Espa침ol",German:"Aleman",_consumption_:"Consumo Actual",_perShelly_:"por Shelly",Running:"Corriendo",Connected:"Connectado",_welcome_:"Bienvenido de nuevo 游녦",Filters:"Filtrar",_sortby_:"Clasificaci칩n",Submit:"Entregar",Clear:"Borrar",Alias:"Alias",Model:"Modelo",Generation:"Generaci칩n",_byminute_:"por Minuto",_byhour_:"por Hora",_byday_:"por Dia",_bymonth_:"por Mes",_byyear_:"por A침o",_notconnected_:"Desconnectado!",_getinvolved_:"Participar!",_gotogithub_:"Ir a Github",_opensource_:"Open Source AGPL Licencia",Home:"Home",Profile:"Perfil",Security:"Securidad",Settings:"Ajustes",Logout:"Cerrar sesi칩n",_forgotpw_:"Contrase침a olvidado?",_wrongpw_:"Contrase침a incorrecto!",_usernotexists_:"Correo electr칩nico incorrecto!",_resetpw_:"Contrase침a restablecida.",Password:"Contrase침a",Email:"Correo electr칩nico",Firstname:"Nombre",Lastname:"Apellido",Role:"Rol",_newuser_:"Nuevo Usuario",_editprofile_:"Tu Perfil",_edituserprofile_:"Editar usuario",_editsecurity_:"Tu Acceso",_editsettings:"Tu Adjusto",_searchuser_:"Busca Usuario",Users:"Usuarios",_rowsperpage_:"Filas por p치gina:",of:"de",_morethan_:"mas de",Login:"Acceso",Save:"Guardar",_userupdated_:"Usuario actualizada",_usernotupdated_:"No pudo actualizar el usuario",_usercreated_:"Usario creado",_usernotcreated_:"No se pudo crear el usuario",_blogpostcreated_:"Post creado",_blogpostnotcreated_:"No se pudo crear el post",_blogpostupdated_:"Post actualizada",_blogpostnotupdated_:"No pudo actualizar el post",Delete:"Borrar",Edit:"Editar",_reallydelete_:"Realmente Borrar?",_userdeleted_:"Usuario eliminado",_usernotdeleted:"No se pudo eliminar el usuario",_emailexists_:"El correo electr칩nico ya existe",_aliasexists_:"Alias ya existe",Read:"Ya le칤",Unread:"No le칤do",_unreadmessages_:"Tienes {{totalUnRead}} nuevos mensajes",_markallasread_:"Marcar todo como le칤do",Brightness:"Brillo",White:"Blanco",Control:"Ajustes",_newpost_:"Nuevo Post",Title:"Titulo",Content:"Contenido",_editpost_:"Editar Post","_editor-preview_":"Previsi칩n","_editor-bold_":"Gordo","_editor-italic_":"It치lico","_editor-strike_":"Tachado","_editor-underline_":"Testado","_editor-link_":"Enlace","_editor-bulletlist_":"Enumeraci칩n","_editor-orderedlist_":"Numeraci칩n","_editor-alignleft_":"Alinear Izquierda","_editor-aligncenter_":"Alinear Central","_editor-alignright_":"Alinear Derecha","_editor-alignjustify_":"Alinear Igualmente","_editor-blockquote_":"Cita","_editor-codeblock_":"Codeblock","_editor-undo_":"Atr치s","_editor-redo_":"Rehacer","_editor-normaltext_":"Normal","_editor-h1_":"Sobrescritura1","_editor-h2_":"Sobrescritura2","_editor-h3_":"Sobrescritura3","_editor-h4_":"Sobrescritura4","_editor-h5_":"Sobrescritura5","_editor-h6_":"Sobrescritura6","_editor-insertlink_":"Entrar Enlace","_editor-invalidlink_":"Enlace Invalido","_editor-color_":"Color del texto","_editor-placeholder_":"Escribir tu post",_notfound_:"No encontrado",_noresultsfor_:"No se encontraron resultados para",selected:"seleccionado",_assigndevices_:"relacionar Shelly",_devicesupdated_:"Relacion guardada",_devicesnotupdated:"Error al guardar"},_s={translation:js},Fe=[{value:"en",label:"English"},{value:"de",label:"German"},{value:"es",label:"Spanish"}],ys=()=>{const t=localStorage.getItem("i18nLanguage");if(t!==null)return console.log(`Using last selected language ${t}`),t;if(typeof navigator.language<"u"){const n=navigator.language.substring(0,2);if(typeof Fe.find(s=>s.value===n)<"u")return console.log(`Using browser language ${n}`),navigator.language.substring(0,2)}return console.log("Using browser language en"),"en"};wn.use(Cn).init({resources:{en:{...fs},de:{...bs},es:{..._s}},lng:ys()});const vs="modulepreload",ws=function(t){return"/"+t},ut={},ce=function(n,s,r){let o=Promise.resolve();if(s&&s.length>0){let x=function(c){return Promise.all(c.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");o=x(s.map(c=>{if(c=ws(c),c in ut)return;ut[c]=!0;const f=c.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const p=document.createElement("link");if(p.rel=f?"stylesheet":vs,f||(p.as="script"),p.crossOrigin="",p.href=c,u&&p.setAttribute("nonce",u),document.head.appendChild(p),f)return new Promise((b,j)=>{p.addEventListener("load",b),p.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${c}`)))})}))}function l(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return o.then(a=>{for(const u of a||[])u.status==="rejected"&&l(u.reason);return n().catch(l)})},Be=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),m=()=>"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t=>(+t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>+t/4).toString(16)),ee=(t,n)=>t<n?t:t%n===0?n:t%n;function pt(t){return us().update(t).digest("hex")}function Cs(t,n,s){if(typeof n>"u"||n==="")throw new Error("Failed to authenticate!  Please supply a password!");if(typeof t>"u"||t.auth_type!=="digest")throw new Error("The message contains no authentication information");const r={nonce:t.nonce,nc:t.nc,realm:t.realm,algorithm:t.algorithm};return Ss(r,n,s)}function Ss(t,n,s){t.username=s,t.cnonce=String(Math.floor(Math.random()*1e9));let r=pt(`${t.username}:${t.realm}:${n}`);return r+=`:${t.nonce}`,r+=`:1:${t.cnonce}`,t.response=pt(r),t}const St=(t,n)=>{document.addEventListener(t,n)},ks=(t,n)=>{document.removeEventListener(t,n)},oe=(t,n)=>{const s=new CustomEvent(t,{detail:n});document.dispatchEvent(s)},kt=i.createContext(),V=()=>i.useContext(kt),$s=({children:t})=>{const[n,s]=i.useState(JSON.parse(localStorage.getItem("user"))),[r,o]=i.useState([]),[l,a]=i.useState(null),[u,x]=i.useState(.001),c=i.useRef(null),f=i.useRef({}),h=i.useRef({}),p=i.useRef(!1),b=i.useRef(null),j=i.useRef({event:"user reconnect",data:{name:"Shelly Context",channelID:`sc${m()}`,message:"Hello from Shelly Context",user:n}}),C=i.useRef(["user validate","blogposts get public"]),w=(S,F)=>{j.current.data.user!==null&&(F&&(S=.001),p.current=!0,setTimeout(()=>{if(c.current!==null&&c.current.readyState===WebSocket.OPEN){p.current=!1;return}if(S>window.scconfig.RECONNECT_MAX){p.current=!1,console.log("Reconnecting makes no sense! Please reload Page"),oe("lastUpdatedAt",null);return}console.log(`Trying to reconnect: ${S}`),x(S+1),w(S+1,!1)},S*window.scconfig.RECONNECT_DELAY*1e3))},v=(S,F)=>{F.forEach(I=>{typeof f.current[I]>"u"?f.current[I]=[S]:f.current[I].push(S)})},k=(S,F)=>{F.forEach(I=>{typeof f.current[I]<"u"&&(f.current[I]=f.current[I].filter(U=>U.subscriptionID!==S))})},g=i.useCallback(S=>{const F=!C.current.includes(S.event);if(F&&(S.data.secret=b.current),c.current!==null&&c.current.readyState===WebSocket.OPEN&&(!F||b.current!==null))c.current.send(JSON.stringify(S));else{const I=m();h.current[I]={msg:S,undefined:void 0},p.current||w(u,!0)}},[w,u]),T=i.useCallback((S,F)=>{let I=!1;if(Object.values(h.current).forEach(A=>{A.msg.event===S.event&&(I=!0)}),I)return;if(S.event==="user validate")a({msg:S,callback:F});else{const A=m();S.data.requestID=A,h.current[A]={msg:S,callback:F}}const U=!C.current.includes(S.event);U&&(S.data.secret=b.current),c.current!==null&&c.current.readyState===WebSocket.OPEN&&(!U||b.current!==null)?c.current.send(JSON.stringify(S)):!p.current&&(c.current===null||c.current.readyState!==WebSocket.OPEN)&&w(u,!0)},[w,u]),R=i.useCallback(S=>{s(S),j.current.data.user=S,console.log(`Connecting the logged in user '${S.alias}'`),c.current.send(JSON.stringify(j.current))},[]),_=i.useCallback(()=>{c.current.close(4001,"User logged out"),s(null),o([])},[]);return i.useEffect(()=>{n!==null?localStorage.setItem("user",JSON.stringify(n)):(localStorage.removeItem("user"),j.current.data.user=null,o([]))},[n]),i.useEffect(()=>{if(c.current===null||p&&c.current.readyState!==WebSocket.OPEN){oe("lastUpdatedAt","connecting");const S=window.scconfig.WSSURL;console.log(`Creating websocket connection to ${S}`),c.current=new ds.w3cwebsocket(S)}c.current.onerror=S=>console.error(S),c.current.onopen=S=>{p.current=!1,oe("lastUpdatedAt",Date.now()),console.log("WebSocket connection opened for Shelly Context!"),l!==null?(console.log("Sending an existing validation request"),c.current.send(JSON.stringify({event:"user validate",data:{source:l.msg.data.source,message:l.msg.data.message,user:{email:l.msg.data.user.email}}}))):j.current.data.user!==null&&(console.log(`Reconnecting the previously logged in user '${j.current.data.user.alias}'`),c.current.send(JSON.stringify(j.current))),Object.entries(h.current).forEach(F=>{const[I,U]=F;C.current.includes(U.msg.event)&&(console.log(`Sending '${U.msg.event}' after opening the websocket`),c.current.send(JSON.stringify(U.msg))),typeof U.callback>"u"&&delete h[I]})},c.current.onmessage=S=>{oe("lastUpdatedAt",Date.now());const F=JSON.parse(S.data);if(F!==null)if(F.event==="user validate")l!==null&&typeof F.data.error<"u"&&F.data.error.code===401?(l.msg.data.auth=Cs(F.data.error.message,l.msg.data.user.password,l.msg.data.user.email),delete l.msg.data.user.password,delete l.msg.data.error,c.current.send(JSON.stringify(l.msg))):(b.current=F.data.secret,delete F.data.secret,l.callback(F),a(null),console.log(`Deleted the 'user validate' request. Now have ${Object.entries(h.current).length} requests left`));else if(F.event==="user reconnect")if(typeof F.data.secret<"u"){const I=j.current.data.user;console.log(`Just reconnected with user ${I.alias}. There are ${Object.entries(h.current).length} outstanding requests`),b.current=F.data.secret,r.length===0&&(console.log(`Requesting devices of user ${I.alias}.`),c.current.send(JSON.stringify({event:"devices get all",data:{source:"Shelly Context",message:"Shelly Context needs the list of devices",userid:I.roleid!=1?I.id:null,secret:b.current}}))),Object.entries(h.current).forEach(U=>{const[A,J]=U;C.current.includes(F.event)||(J.msg.data.secret=b.current),console.log(`Sending '${J.msg.event}' after reconnecting`),c.current.send(JSON.stringify(J.msg)),typeof J.callback>"u"&&delete h[A]})}else console.error("Reconnecting was not possible. Logging out!"),_();else F.event==="devices get all"?(console.log(`Received ${F.data.devices.length} devices for user ${n.alias}`),o(F.data.devices)):F.event==="ping"?c.current.send(JSON.stringify({event:"pong",data:{source:"SC Context",message:F.data.message}})):typeof F.data.requestID<"u"&&typeof h.current[F.data.requestID]<"u"?(h.current[F.data.requestID].callback(F),delete h.current[F.data.requestID],console.log(`Deleted request '${F.event}' on answer: '${F.data.message}'. Now have ${Object.entries(h.current).length} requests`)):typeof F.event<"u"?typeof f.current[F.event]<"u"&&f.current[F.event].forEach(I=>{(I.all||F.data.subscriptionID===I.subscriptionID)&&I.callback(F)}):console.error(`Shelly context received an unhandled message ${JSON.stringify(F)} `)},c.current.onclose=S=>{p.current?oe("lastUpdatedAt",null):(oe("lastUpdatedAt","connecting"),w(u,!0)),c.current?console.log(`WebSocket connection closed by the server for SC Context. Reason: ${S.reason}!`):console.log(`WebSocket connection closed because SC Context was unmounted. Reason: ${S.reason}!`)}},[l,w,u,_,r]),e.jsx(kt.Provider,{value:i.useMemo(()=>({user:n,devices:r,login:R,logout:_,subscribe:v,unsubscribe:k,request:T,send:g}),[n,r,R,_,T,g]),children:t})};function $t(){const{pathname:t}=De();return i.useMemo(()=>t,[t])}const Pt=i.forwardRef(({href:t,...n},s)=>e.jsx($n,{ref:s,to:t,...n}));function Xe(t,n,s){const r=je(),o=Ce(r.breakpoints.up(n));return Ce(r.breakpoints.down(n)),Ce(r.breakpoints.between(n,s)),Ce(r.breakpoints.only(n)),o}const ye=i.forwardRef(({disabledLink:t=!1,sx:n,...s},r)=>{const o=e.jsx(O,{component:"img",src:"/assets/logo.svg",sx:{width:40,height:40,...n}});return t?o:e.jsxs($,{direction:"row",spacing:2,sx:{justifyContent:"flex-start",alignItems:"center"},children:[e.jsx(O,{sx:{display:"contents"},children:o}),e.jsx(P,{variant:"h6",sx:{pt:3},children:"S-Central"})]})});ye.propTypes={disabledLink:d.bool,sx:d.object};const Ps=Ie("div")(()=>({flexGrow:1,height:"100%",overflow:"hidden"})),Fs=Ie(xs)(({theme:t})=>({maxHeight:"100%","& .simplebar-scrollbar":{"&:before":{backgroundColor:E(t.palette.grey[600],.48)},"&.simplebar-visible:before":{opacity:1}},"& .simplebar-mask":{zIndex:"inherit"}})),Ft=i.forwardRef(({children:t,sx:n,...s},r)=>{const o=typeof navigator>"u"?"SSR":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(o)?e.jsx(O,{ref:r,sx:{overflow:"auto",...n},...s,children:t}):e.jsx(Ps,{children:e.jsx(Fs,{scrollableNodeProps:{ref:r},clickOnTrack:!1,sx:n,...s,children:t})})});Ft.propTypes={children:d.node,sx:d.object};const Le=i.memo(Ft),Oe={H_MOBILE:64,H_DESKTOP:80},fe={WIDTH:280},Qe=i.forwardRef(({src:t,sx:n,...s},r)=>e.jsx(O,{component:"span",className:"svg-color",ref:r,sx:{width:24,height:24,display:"inline-block",bgcolor:"currentColor",mask:`url(${t}) no-repeat center / contain`,WebkitMask:`url(${t}) no-repeat center / contain`,...n},...s}));Qe.propTypes={src:d.string,sx:d.object};const Pe=t=>e.jsx(Qe,{src:`/assets/icons/navbar/${t}.svg`,sx:{width:1,height:1}}),Rs=[{title:"dashboard",path:"/dashboard",icon:Pe("ic_analytics"),minRole:"User"},{title:"shellies",path:"/shellies",icon:Pe("ic_device"),minRole:"User"},{title:"blog",path:"/blog",icon:Pe("ic_blog"),minRole:"User"},{title:"user",path:"/user",icon:Pe("ic_user"),minRole:"Admin"}];function Rt({openNav:t,onCloseNav:n}){const s=$t(),{user:r}=V(),{t:o}=L(),l=Xe("up","lg");i.useEffect(()=>{t&&n()},[s]);const a=e.jsxs(O,{sx:{my:3,mx:2.5,py:2,px:2.5,display:"flex",borderRadius:1.5,alignItems:"center",bgcolor:f=>E(f.palette.grey[500],.12)},children:[e.jsx(pe,{src:`/assets/images/avatars/avatar_${ee(r.id,25)}.jpg`,alt:"photoURL"}),e.jsxs(O,{sx:{ml:2},children:[e.jsx(P,{variant:"subtitle2",children:`${r.firstname!==null?r.firstname:r.alias} ${r.lastname!==null?r.lastname:r.alias}`}),e.jsx(P,{variant:"body2",sx:{color:"text.secondary"},children:r.role})]})]}),u=e.jsx($,{component:"nav",spacing:.5,sx:{px:2},children:Rs.map(f=>f.minRole==="User"||f.minRole==="Admin"&&r.roleid===1?e.jsx(Tt,{item:f},f.title):null)}),x=e.jsx(O,{sx:{px:2.5,pb:3,mt:10},children:e.jsxs($,{alignItems:"center",spacing:3,sx:{pt:5,borderRadius:2,position:"relative"},children:[e.jsx(O,{sx:{width:100,position:"absolute",top:-50},children:e.jsx(pe,{src:"/assets/illustrations/avatar_main.jpg",sx:{width:100,height:100}})}),e.jsxs(O,{sx:{textAlign:"center"},children:[e.jsx(P,{variant:"h6",children:o("_getinvolved_")}),e.jsx(P,{variant:"body2",sx:{color:"text.secondary",mt:1},children:o("_opensource_")})]}),e.jsx(Y,{href:"https://github.com/akreienbring/s-central",target:"_blank",variant:"contained",color:"inherit",children:o("_gotogithub_")})]})}),c=e.jsxs(Le,{sx:{height:1,"& .simplebar-content":{height:1,display:"flex",flexDirection:"column"}},children:[e.jsx(ye,{sx:{mt:3,ml:4}}),a,u,e.jsx(O,{sx:{flexGrow:1}}),x]});return e.jsx(O,{sx:{flexShrink:{lg:0},width:{lg:fe.WIDTH}},children:l?e.jsx(O,{sx:{height:1,position:"fixed",width:fe.WIDTH,borderRight:f=>`dashed 1px ${f.palette.divider}`},children:c}):e.jsx(ae,{open:t,onClose:n,slotProps:{paper:{sx:{width:fe.WIDTH}}},children:c})})}Rt.propTypes={openNav:d.bool,onCloseNav:d.func};function Tt({item:t}){const n=$t(),{t:s}=L(),r=t.path===n;return e.jsxs(vt,{component:Pt,href:t.path,sx:{minHeight:44,borderRadius:.75,typography:"body2",color:"text.secondary",textTransform:"capitalize",fontWeight:"fontWeightMedium",...r&&{color:"primary.main",fontWeight:"fontWeightSemiBold",bgcolor:o=>E(o.palette.primary.main,.08),"&:hover":{bgcolor:o=>E(o.palette.primary.main,.16)}}},children:[e.jsx(O,{component:"span",sx:{width:24,height:24,mr:2},children:t.icon}),e.jsxs(O,{component:"span",children:[t.title==="user"?s("Users"):t.title," "]})]})}Tt.propTypes={item:d.object};const ht=8;function Ot({children:t,sx:n,...s}){const r=Xe("up","lg");return e.jsx(O,{component:"main",sx:{flexGrow:1,minHeight:1,display:"flex",flexDirection:"column",py:`${Oe.H_MOBILE+ht}px`,...r&&{px:2,py:`${Oe.H_DESKTOP+ht}px`,width:`calc(100% - ${fe.WIDTH}px)`},...n},...s,children:t})}Ot.propTypes={children:d.node,sx:d.object};function Re(t){const n=t?.color||"#000000",s=t?.blur||6,r=t?.opacity||.8,o=t?.imgUrl;return o?{position:"relative",backgroundImage:`url(${o})`,"&:before":{position:"absolute",top:0,left:0,zIndex:9,content:'""',width:"100%",height:"100%",backdropFilter:`blur(${s}px)`,WebkitBackdropFilter:`blur(${s}px)`,backgroundColor:E(n,r)}}:{backdropFilter:`blur(${s}px)`,WebkitBackdropFilter:`blur(${s}px)`,backgroundColor:E(n,r)}}function Ts(t){const n=t?.direction||"to bottom",s=t?.startColor,r=t?.endColor,o=t?.imgUrl,l=t?.color;return{background:`linear-gradient(${n}, ${s||l}, ${r||l}), url(${o})`,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center center"}}const y=i.forwardRef(({icon:t,width:n=25,sx:s,...r},o)=>e.jsx(O,{ref:o,component:ps,className:"component-iconify",icon:t,sx:{width:n,height:n,...s},...r}));y.propTypes={icon:d.oneOfType([d.element,d.string]),sx:d.object,width:d.number};function Os(t,n){return t?Ye(new Date(t),"dd MMM yyyy"):""}function Ds(t,n){const s=n;return t?Ye(new Date(t),s):""}function Dt(t,n){return t?Ye(ns(t),n):""}const Es=()=>{const[t,n]=i.useState("connecting"),{t:s}=L(),r=Ee(),o=i.useCallback(a=>{a!==null&&n(a.detail)},[]);i.useEffect(()=>(St("lastUpdatedAt",o),()=>{ks("lastUpdatedAt")}),[o,t]);const l=()=>{t===null&&(n(void 0),r(0))};return t===0?null:e.jsx(Y,{variant:"contained",color:t!==null&&t!=="connecting"?"success":"error",startIcon:t==="connecting"||t==="loading"?e.jsx(Tn,{size:25,variant:"indeterminate",color:"common.white"}):e.jsx(y,{icon:"carbon:update-now"}),onClick:l,children:t!==null&&t!=="connecting"&&t!=="loading"?Ds(t,"HH:mm:ss"):s("_notconnected_")})},Et=({type:t,requestResult:n,roles:s,currentUser:r,setRequestResult:o,setCurrentUser:l,handleForgotten:a,handleCurrentUser:u})=>{const{user:x}=V(),[c,f]=i.useState(t==="create"?"dashboard":r.home),[h,p]=i.useState(""),[b,j]=i.useState(!1),{t:C}=L(),w=i.useRef(!1),v=i.useRef(r);i.useEffect(()=>{!w.current&&s.length>0&&(p(r.roleid),w.current=!0)},[s,n,r]);const k=()=>{o({success:!0,message:""})},g=({target:_})=>{const S={...r};_.name==="role"?(p(_.value),S.role=s[_.value-1].name,S.roleid=_.value):_.name==="home"?(f(_.value),S.home=_.value):_.name==="alias"?S[_.name]=_.value.trim():S[_.name]=_.value,l(S)},T=_=>{_.preventDefault(),v.current=r,u(r)},R=()=>{if(r===null)return!0;let _=!1;return t==="login"&&(_=typeof r.email>"u"||r.email.length===0||typeof r.password>"u"||r.password.length===0||!Be(r.email)),(t==="profile"||t==="settings")&&(_=(r.alias===v.current.alias||r.alias.length===0)&&r.firstname===v.current.firstname&&r.lastname===v.current.lastname&&r.home===v.current.home),t==="create"&&(_=typeof r.email>"u"||r.email.length===0||!Be(r.email)||typeof r.alias>"u"||r.alias.length===0),t==="security"&&(_=!Be(r.email)||r.password!==r.password2||typeof r.password>"u"||r.password.length===0||typeof r.password2>"u"||r.password.length2===0),_};return e.jsx("form",{onSubmit:T,children:e.jsx(Ae,{fullWidth:!0,size:"subtitle2",children:e.jsxs($,{spacing:3,sx:{px:3,py:3},children:[(t==="login"||t==="create"||t==="security")&&e.jsx(te,{required:!0,value:r.email,name:"email",label:C("Email"),onFocus:k,onChange:g}),(t==="login"||t==="security")&&e.jsx(te,{name:"password",required:!0,label:C("Password"),onFocus:k,onChange:g,type:b?"text":"password",slotProps:{input:{endAdornment:e.jsx(We,{position:"end",children:e.jsx(H,{onClick:()=>j(!b),edge:"end",children:e.jsx(y,{icon:b?"eva:eye-fill":"eva:eye-off-fill"})})})}}}),t==="security"&&e.jsx(te,{required:!0,name:"password2",label:C("Password"),onFocus:k,onChange:g,type:b?"text":"password",slotProps:{input:{endAdornment:e.jsx(We,{position:"end",children:e.jsx(H,{onClick:()=>j(!b),edge:"end",children:e.jsx(y,{icon:b?"eva:eye-fill":"eva:eye-off-fill"})})})}}}),(t==="profile"||t==="create")&&e.jsxs($,{spacing:3,children:[e.jsx(te,{required:!0,value:r.alias,name:"alias",label:C("Alias"),onChange:g,onFocus:k}),e.jsx(te,{value:r.firstname?r.firstname:"",name:"firstname",label:C("Firstname"),onChange:g,onFocus:k}),e.jsx(te,{value:r.lastname?r.lastname:"",name:"lastname",label:C("Lastname"),onChange:g,onFocus:k}),e.jsx(te,{disabled:x.id===r.id||r.id===1,required:!0,select:!0,value:h,name:"role",label:C("Role"),onChange:g,onFocus:k,children:typeof s<"u"?s.map(_=>e.jsx(W,{value:_.id,children:_.name},_.name)):null})]}),(t==="settings"||t==="create")&&e.jsxs(te,{required:!0,select:!0,value:c||"dashboard",name:"home",label:C("Home"),onChange:g,onFocus:k,children:[e.jsx(W,{value:"dashboard",children:"Dashboard"}),e.jsx(W,{value:"shellies",children:"Shellies"})]}),e.jsxs($,{direction:"row",alignItems:"baseline",justifyContent:"space-between",spacing:1,children:[e.jsx(P,{variant:"subtitle2",color:n.success?"success":"error",children:C(n.message)}),t==="login"&&e.jsx(Ve,{variant:"subtitle2",underline:"hover",color:"primary",style:{cursor:"pointer"},onClick:()=>a(r.email),children:C("_forgotpw_")})]}),t==="login"?e.jsx(Y,{disabled:R(),fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",children:C("Login")}):e.jsx(Y,{disabled:R(),fullWidth:!0,size:"large",type:"submit",color:"inherit",variant:"outlined",startIcon:e.jsx(y,{icon:"formkit:submit"}),children:C("Save")})]})})})};Et.propTypes={type:d.string,currentUser:d.object,setCurrentUser:d.func,requestResult:d.object,setRequestResult:d.func,roles:d.array,handleForgotten:d.func,handleCurrentUser:d.func};const Ue=({type:t,updateuser:n,handleUsersReceived:s,handleUpdateUser:r})=>{const{login:o,user:l,request:a}=V(),[u,x]=i.useState(()=>t==="profile"||t==="settings"||t==="security"?typeof n>"u"?{...l}:n:{alias:"",email:"",firstname:"",lastname:"",password:"",home:"dashboard",roleid:3}),[c,f]=i.useState([]),[h,p]=i.useState({success:!0,message:""}),b=Ee(),j=De(),C=i.useCallback(_=>{_.data.success?(x(_.data.user),o(_.data.user),b(`/${_.data.user.home!==null?_.data.user.home:"dashboard"}`)):p({success:!1,message:_.data.message})},[b,o]),w=i.useCallback(_=>{p({success:_.data.success,message:_.data.message}),l.id===u.id&&o(u),typeof r<"u"?r(u):j.pathname==="/user"&&oe("userUpdated",u)},[l,u,o,r,j]),v=i.useCallback(_=>{p({success:_.data.success,message:_.data.message}),_.data.success&&s(_)},[s]),k=i.useCallback(_=>{f(_.data.roles)},[]),g=i.useCallback(_=>{p({success:_.data.success,message:_.data.message})},[]);i.useEffect(()=>{(t==="profile"||t==="create")&&a({event:"roles get all",data:{source:"Users Form",message:"User Form needs the list of roles"}},k)},[t,k,a]);const T=_=>{t==="login"?a({event:"user validate",data:{source:"User Form",message:"User Form wants to validate a user",user:_}},C):t==="profile"?a({event:"user profile update",data:{source:"User Form",message:"User Form wants to update a users profile",user:_}},w):t==="create"?a({event:"user create",data:{source:"User Form ",message:"User Form wants to create a new user",user:_}},v):t==="security"?a({event:"user security update",data:{source:"User Form ",message:"User Form  wants to update a users credentials",user:_}},w):t==="settings"&&a({event:"user settings update",data:{source:"User Form ",message:"User Form  wants to update a users settings",user:_}},w)},R=_=>{a({event:"user resetpw",data:{source:"User Form",message:"User Form wants to reset a password",email:_}},g)};return e.jsx(Et,{type:t,roles:c,requestResult:h,currentUser:u,setCurrentUser:x,setRequestResult:p,handleForgotten:R,handleCurrentUser:T})};Ue.propTypes={type:d.string,updateuser:d.object,handleUsersReceived:d.func,handleUpdateUser:d.func};function It({title:t,openUpdate:n,type:s,updateuser:r,onCloseUpdate:o,handleUpdateUser:l}){return e.jsxs(ae,{anchor:"right",open:n,onClose:o,slotProps:{paper:{sx:{width:300,border:"none",overflow:"hidden"}}},children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{px:1,py:2},children:[e.jsx(P,{variant:"h6",sx:{ml:1},children:t}),e.jsx(H,{onClick:o,children:e.jsx(y,{icon:"eva:close-fill"})})]}),e.jsx(ne,{}),e.jsx(Ue,{type:s,updateuser:r,handleUpdateUser:l})]})}function Is(){const[t,n]=i.useState(null),[s,r]=i.useState({open:!1,type:""}),{user:o,logout:l}=V(),{t:a}=L(),u=Ee(),x=j=>{p(),r({open:!0,type:j})},c=()=>{r({open:!1,type:""})},f=()=>{p(),u(`${o.home}`)},h=j=>{n(j.currentTarget)},p=()=>{n(null)},b=j=>a(j==="profile"?"_editprofile_":j==="security"?"_editsecurity_":"_editsettings");return e.jsxs(e.Fragment,{children:[e.jsx(H,{onClick:h,sx:{width:40,height:40,background:j=>E(j.palette.grey[500],.08),...t&&{background:j=>`linear-gradient(135deg, ${j.palette.primary.light} 0%, ${j.palette.primary.main} 100%)`}},children:e.jsx(pe,{src:`/assets/images/avatars/avatar_${ee(o.id,25)}.jpg`,alt:o.name,sx:{width:36,height:36,border:j=>`solid 2px ${j.palette.background.default}`},children:`${o.firstname!==null?o.firstname:o.alias} ${o.lastname!==null?o.lastname:o.alias}`})}),e.jsxs(_e,{open:!!t,anchorEl:t,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},marginThreshold:8,slotProps:{paper:{sx:{p:0,mt:1,ml:.75,width:200}}},children:[e.jsxs(O,{sx:{my:1.5,px:2},children:[e.jsx(P,{variant:"subtitle2",noWrap:!0,children:`${o.firstname!==null?o.firstname:o.alias} ${o.lastname!==null?o.lastname:o.alias}`}),e.jsx(P,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:o.email})]}),e.jsx(ne,{sx:{borderStyle:"dashed"}}),e.jsxs(W,{onClick:f,children:[e.jsx(Se,{children:e.jsx(y,{icon:"eva:home-fill"})}),e.jsx(xe,{primary:a("Home")})]},"Home"),e.jsxs(W,{onClick:()=>x("profile"),children:[e.jsx(Se,{children:e.jsx(y,{icon:"eva:person-fill"})}),e.jsx(xe,{primary:a("Profile")})]},"Profile"),e.jsxs(W,{onClick:()=>x("security"),children:[e.jsx(Se,{children:e.jsx(y,{icon:"eva:lock-fill"})}),e.jsx(xe,{primary:a("Security")})]},"Security"),e.jsxs(W,{onClick:()=>x("settings"),children:[e.jsx(Se,{children:e.jsx(y,{icon:"eva:settings-2-fill"})}),e.jsx(xe,{primary:a("Settings")})]},"Settings"),e.jsx(ne,{sx:{borderStyle:"dashed",m:0}}),e.jsx(W,{disableRipple:!0,disableTouchRipple:!0,onClick:l,sx:{typography:"body2",color:"error.main",py:1.5},children:a("Logout")})]}),e.jsx(It,{title:b(s.type),openUpdate:s.open,type:s.type,onCloseUpdate:c})]})}function As(){const[t,n]=i.useState(null),{t:s,i18n:{changeLanguage:r,language:o}}=L(),[l,a]=i.useState(o),[u,x]=i.useState(0),c=(p,b)=>{a(p),x(b),r(p),localStorage.setItem("i18nLanguage",p),h()},f=p=>{n(p.currentTarget)},h=()=>{n(null)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{onClick:f,sx:{width:40,height:40,...t&&{bgcolor:"action.selected"}},children:e.jsx("img",{src:`/assets/icons/flags/${l}.svg`,alt:s(Fe[u].label)})}),e.jsx(_e,{open:!!t,anchorEl:t,onClose:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{p:0,mt:1,ml:.75,width:180}}},children:Fe.map((p,b)=>e.jsxs(W,{selected:p.value===Fe[u].value,onClick:j=>c(p.value,b),sx:{typography:"body2",py:1},children:[e.jsx(O,{component:"img",alt:p.label,src:`/assets/icons/flags/${p.value}.svg`,sx:{width:28,mr:2}}),s(p.label)]},p.value))})]})}function Ns(){const[t,n]=i.useState([]),s=t.filter(g=>g.isUnread===!0).length,[r,o]=i.useState(null),{request:l,subscribe:a,unsubscribe:u,send:x}=V(),c=i.useRef(m()),f=i.useRef(!1),{t:h}=L(),p=i.useCallback(g=>{const{notification:T}=g.data,R=[...t];R.push({id:T.id,type:T.type,title:T.title,description:T.notification,avatar:null,createdAt:new Date(T.ts),isUnread:T.isUnread===1}),n(R)},[t]),b=i.useCallback(g=>{f.current=!0;const T=g.data.notifications.map((R,_)=>({id:R.id,type:R.type,title:R.title,description:R.notification,avatar:null,createdAt:new Date(R.ts),isUnread:R.isUnread===1}));n(T)},[n]);i.useEffect(()=>{const g=c.current;return f.current||l({event:"notifications get all",data:{source:"Notifications Popover",message:"Notifications Popover needs the list of notifications"}},b),a({subscriptionID:c.current,callback:p,all:!0},["notification create"]),()=>{u(g,["notification create"])}},[b,p,a,u,l]);const j=g=>{o(g.currentTarget)},C=()=>{o(null)},w=()=>{const g=[],T=t.map(R=>(R.isUnread=!1,g.push(R.id),R));n(T),x({event:"notification update",data:{source:"Notifications Popover",message:"Notifications Popover wants to update notifications",ids:g}})},v=g=>{const T=[],R=t.map(_=>(g.id===_.id&&(_.isUnread=!1,T.push(_.id)),_));n(R),x({event:"notification update",data:{source:"Notifications Popover",message:"Notifications Popover wants to update notifications",ids:T}})},k=g=>{l({event:"notification delete",data:{source:"Notifications Popover",message:"Notifications Popover wants to delete a notification",ids:[g]}},b)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{color:r?"primary":"default",onClick:j,children:e.jsx(On,{badgeContent:s,color:"error",children:e.jsx(y,{width:24,icon:"solar:bell-bing-bold-duotone"})})}),e.jsxs(_e,{open:!!r,anchorEl:r,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{mt:1.5,ml:.75,width:360}}},children:[e.jsxs(O,{sx:{display:"flex",alignItems:"center",py:2,px:2.5},children:[e.jsxs(O,{sx:{flexGrow:1},children:[e.jsx(P,{variant:"subtitle1",children:h("Notifications")}),e.jsx(P,{variant:"body2",sx:{color:"text.secondary"},children:h("_unreadmessages_",{totalUnRead:s})})]}),s>0&&e.jsx(Je,{title:h("_markallasread_"),children:e.jsx(H,{color:"primary",onClick:w,children:e.jsx(y,{icon:"eva:done-all-fill"})})})]}),e.jsx(ne,{sx:{borderStyle:"dashed"}}),e.jsxs(Le,{sx:{height:{xs:340,sm:"auto"}},children:[e.jsx(ot,{disablePadding:!0,subheader:e.jsx(it,{disableSticky:!0,sx:{py:1,px:2.5,typography:"overline"},children:h("Unread")}),children:t.filter(g=>g.isUnread===!0).map(g=>e.jsx(ze,{notification:g,handleItemClick:v},m()))}),e.jsx(ot,{disablePadding:!0,subheader:e.jsx(it,{disableSticky:!0,sx:{py:1,px:2.5,typography:"overline"},children:h("Read")}),children:t.filter(g=>g.isUnread===!1).map(g=>e.jsx(ze,{notification:g,handleItemDelete:k},m()))})]})]})]})}function ze({notification:t,handleItemClick:n,handleItemDelete:s}){const{avatar:r,title:o}=Ls(t),{i18n:l}=L(),a=()=>{switch(l.language){case"en":return ct;case"de":return os;case"es":return rs;default:return ct}};return e.jsxs(vt,{onClick:u=>{t.isUnread&&n(t)},sx:{py:1.5,px:2.5,mt:"1px",...t.isUnread&&{bgcolor:"action.selected"}},children:[e.jsx(Dn,{children:e.jsx(pe,{sx:{bgcolor:"background.neutral"},children:r})}),e.jsxs($,{direction:"row",spacing:3,alignItems:"start",justifyContent:"space-between",children:[e.jsx(xe,{primary:o,secondary:e.jsxs(P,{variant:"caption",sx:{mt:.5,display:"flex",alignItems:"center",color:"text.disabled"},children:[e.jsx(y,{icon:"eva:clock-outline",sx:{mr:.5,width:16,height:16}}),ss(t.createdAt,{addSuffix:!0,locale:a()})]}),sx:{maxWidth:200}}),!t.isUnread&&e.jsx(H,{onClick:u=>{s(t.id)},children:e.jsx(y,{icon:"eva:trash-2-outline",sx:{mr:2}})})]})]})}function Ls(t){const n=e.jsxs(e.Fragment,{children:[e.jsxs(P,{variant:"subtitle2",children:[t.title," "]}),e.jsx(P,{component:"span",variant:"body2",style:{whiteSpace:"pre-line"},sx:{color:"text.secondary"},children:t.description})]});return t.type==="script-error"?{avatar:e.jsx("img",{alt:t.title,src:"/assets/icons/ic_notification_error.svg"}),title:n}:t.type==="device-offline"?{avatar:e.jsx("img",{alt:t.title,src:"/assets/icons/ic_notification_offline.svg"}),title:n}:null}ze.propTypes={handleItemDelete:d.func,handleItemClick:d.func,notification:d.shape({createdAt:d.instanceOf(Date),id:d.number,isUnread:d.bool,title:d.string,description:d.string,type:d.string,avatar:d.any})};function At({onOpenNav:t}){const n=je(),s=De(),r=Xe("up","lg"),o=e.jsxs(e.Fragment,{children:[!r&&e.jsx(H,{onClick:t,sx:{mr:1},children:e.jsx(y,{icon:"eva:menu-2-fill"})}),e.jsx(O,{sx:{flexGrow:1}}),e.jsxs($,{direction:"row",alignItems:"center",spacing:1,children:[(s.pathname==="/dashboard"||s.pathname==="/shellies")&&e.jsx(Es,{}),e.jsx(As,{}),e.jsx(Ns,{}),e.jsx(Is,{})]})]});return e.jsx(En,{sx:{boxShadow:"none",height:Oe.H_MOBILE,zIndex:n.zIndex.appBar+1,...Re({color:n.palette.background.default}),transition:n.transitions.create(["height"],{duration:n.transitions.duration.shorter}),...r&&{width:`calc(100% - ${fe.WIDTH+1}px)`,height:Oe.H_DESKTOP}},children:e.jsx(wt,{sx:{height:1,px:{lg:5}},children:o})})}At.propTypes={onOpenNav:d.func};function Nt({children:t}){const[n,s]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(At,{onOpenNav:()=>s(!0)}),e.jsxs(O,{sx:{minHeight:1,display:"flex",flexDirection:{xs:"column",lg:"row"}},children:[e.jsx(Rt,{openNav:n,onCloseNav:()=>s(!1)}),e.jsx(Ot,{children:t})]})]})}Nt.propTypes={children:d.node};const xt=i.lazy(()=>ce(()=>Promise.resolve().then(()=>dr),void 0)),gt=i.lazy(()=>ce(()=>Promise.resolve().then(()=>hr),void 0)),Us=i.lazy(()=>ce(()=>Promise.resolve().then(()=>wr),void 0)),ft=i.lazy(()=>ce(()=>Promise.resolve().then(()=>$r),void 0)),Bs=i.lazy(()=>ce(()=>Promise.resolve().then(()=>Rr),void 0)),mt=i.lazy(()=>ce(()=>Promise.resolve().then(()=>qr),void 0)),Ms=i.lazy(()=>ce(()=>Promise.resolve().then(()=>Vr),void 0));function Ws(){const{user:t}=V();return Pn([{path:"/",element:window.scconfig.LANDING_PAGE==="login"?e.jsx(ft,{}):e.jsx(Bs,{})},{element:t?e.jsx(Nt,{children:e.jsx(i.Suspense,{children:e.jsx(Fn,{})})}):e.jsx(rt,{to:"/",replace:!0}),children:!t||t.roleid===1?[{path:"dashboard",element:e.jsx(xt,{}),index:!0},{path:"user",element:e.jsx(Us,{})},{path:"shellies",element:e.jsx(mt,{})},{path:"blog",element:e.jsx(gt,{})}]:[{path:"dashboard",element:e.jsx(xt,{}),index:!0},{path:"shellies",element:e.jsx(mt,{})},{path:"blog",element:e.jsx(gt,{})}]},{path:"login",element:e.jsx(ft,{})},{path:"404",element:e.jsx(Ms,{})},{path:"*",element:e.jsx(rt,{to:"/404",replace:!0})}])}function zs(){const{pathname:t}=De();return i.useEffect(()=>{window.scrollTo(0,0)},[t]),null}const M={0:"#FFFFFF",100:"#F9FAFB",200:"#F4F6F8",300:"#DFE3E8",400:"#C4CDD5",500:"#919EAB",600:"#637381",700:"#454F5B",800:"#212B36",900:"#161C24"},Lt={lighter:"#D0ECFE",light:"#73BAFB",main:"#1877F2",dark:"#0C44AE",darker:"#042174",contrastText:"#FFFFFF"},Ut={lighter:"#EFD6FF",light:"#C684FF",main:"#8E33FF",dark:"#5119B7",darker:"#27097A",contrastText:"#FFFFFF"},Bt={lighter:"#CAFDF5",light:"#61F3F3",main:"#00B8D9",dark:"#006C9C",darker:"#003768",contrastText:"#FFFFFF"},Mt={lighter:"#C8FAD6",light:"#5BE49B",main:"#00A76F",dark:"#007867",darker:"#004B50",contrastText:"#FFFFFF"},Wt={lighter:"#FFF5CC",light:"#FFD666",main:"#FFAB00",dark:"#B76E00",darker:"#7A4100",contrastText:M[800]},zt={lighter:"#FFE9D5",light:"#FFAC82",main:"#FF5630",dark:"#B71D18",darker:"#7A0916",contrastText:"#FFFFFF"},qt={black:"#000000",white:"#FFFFFF"},qs={hover:E(M[500],.08),selected:E(M[500],.16),disabled:E(M[500],.8),disabledBackground:E(M[500],.24),focus:E(M[500],.24),hoverOpacity:.08,disabledOpacity:.48},bt={primary:Lt,secondary:Ut,info:Bt,success:Mt,warning:Wt,error:zt,grey:M,common:qt,divider:E(M[500],.2),action:qs};function Hs(){return{...bt,mode:"light",text:{primary:M[800],secondary:M[600],disabled:M[500]},background:{paper:"#FFFFFF",default:M[100],neutral:M[200]},action:{...bt.action,active:M[600]}}}function Gs(){const t=E(M[500],.2),n=E(M[500],.14),s=E(M[500],.12);return["none",`0px 2px 1px -1px ${t},0px 1px 1px 0px ${n},0px 1px 3px 0px ${s}`,`0px 3px 1px -2px ${t},0px 2px 2px 0px ${n},0px 1px 5px 0px ${s}`,`0px 3px 3px -2px ${t},0px 3px 4px 0px ${n},0px 1px 8px 0px ${s}`,`0px 2px 4px -1px ${t},0px 4px 5px 0px ${n},0px 1px 10px 0px ${s}`,`0px 3px 5px -1px ${t},0px 5px 8px 0px ${n},0px 1px 14px 0px ${s}`,`0px 3px 5px -1px ${t},0px 6px 10px 0px ${n},0px 1px 18px 0px ${s}`,`0px 4px 5px -2px ${t},0px 7px 10px 1px ${n},0px 2px 16px 1px ${s}`,`0px 5px 5px -3px ${t},0px 8px 10px 1px ${n},0px 3px 14px 2px ${s}`,`0px 5px 6px -3px ${t},0px 9px 12px 1px ${n},0px 3px 16px 2px ${s}`,`0px 6px 6px -3px ${t},0px 10px 14px 1px ${n},0px 4px 18px 3px ${s}`,`0px 6px 7px -4px ${t},0px 11px 15px 1px ${n},0px 4px 20px 3px ${s}`,`0px 7px 8px -4px ${t},0px 12px 17px 2px ${n},0px 5px 22px 4px ${s}`,`0px 7px 8px -4px ${t},0px 13px 19px 2px ${n},0px 5px 24px 4px ${s}`,`0px 7px 9px -4px ${t},0px 14px 21px 2px ${n},0px 5px 26px 4px ${s}`,`0px 8px 9px -5px ${t},0px 15px 22px 2px ${n},0px 6px 28px 5px ${s}`,`0px 8px 10px -5px ${t},0px 16px 24px 2px ${n},0px 6px 30px 5px ${s}`,`0px 8px 11px -5px ${t},0px 17px 26px 2px ${n},0px 6px 32px 5px ${s}`,`0px 9px 11px -5px ${t},0px 18px 28px 2px ${n},0px 7px 34px 6px ${s}`,`0px 9px 12px -6px ${t},0px 19px 29px 2px ${n},0px 7px 36px 6px ${s}`,`0px 10px 13px -6px ${t},0px 20px 31px 3px ${n},0px 8px 38px 7px ${s}`,`0px 10px 13px -6px ${t},0px 21px 33px 3px ${n},0px 8px 40px 7px ${s}`,`0px 10px 14px -6px ${t},0px 22px 35px 3px ${n},0px 8px 42px 7px ${s}`,`0px 11px 14px -7px ${t},0px 23px 36px 3px ${n},0px 9px 44px 8px ${s}`,`0px 11px 15px -7px ${t},0px 24px 38px 3px ${n},0px 9px 46px 8px ${s}`]}function Vs(t){return{MuiCssBaseline:{styleOverrides:{"*":{boxSizing:"border-box"},html:{margin:0,padding:0,width:"100%",height:"100%",WebkitOverflowScrolling:"touch"},body:{margin:0,padding:0,width:"100%",height:"100%"},"#root":{width:"100%",height:"100%"},input:{"&[type=number]":{MozAppearance:"textfield","&::-webkit-outer-spin-button":{margin:0,WebkitAppearance:"none"},"&::-webkit-inner-spin-button":{margin:0,WebkitAppearance:"none"}}},img:{maxWidth:"100%",display:"inline-block",verticalAlign:"bottom"}}},MuiBackdrop:{styleOverrides:{root:{backgroundColor:E(t.palette.grey[900],.8)},invisible:{background:"transparent"}}},MuiButton:{styleOverrides:{containedInherit:{color:t.palette.common.white,backgroundColor:t.palette.grey[800],"&:hover":{color:t.palette.common.white,backgroundColor:t.palette.grey[800]}},sizeLarge:{minHeight:48}}},MuiCard:{styleOverrides:{root:{boxShadow:t.customShadows.card,borderRadius:Number(t.shape.borderRadius)*2,position:"relative",zIndex:0}}},MuiCardHeader:{defaultProps:{titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"body2"}},styleOverrides:{root:{padding:t.spacing(3,3,0)}}},MuiOutlinedInput:{styleOverrides:{root:{[`& .${In.notchedOutline}`]:{borderColor:E(t.palette.grey[500],.24)}}}},MuiPaper:{defaultProps:{elevation:0}},MuiTableCell:{styleOverrides:{head:{color:t.palette.text.secondary,backgroundColor:t.palette.background.neutral}}},MuiTooltip:{styleOverrides:{tooltip:{backgroundColor:t.palette.grey[800]},arrow:{color:t.palette.grey[800]}}},MuiTypography:{styleOverrides:{paragraph:{marginBottom:t.spacing(2)},gutterBottom:{marginBottom:t.spacing(1)}}},MuiMenuItem:{styleOverrides:{root:{...t.typography.body2}}}}}function K(t){return`${t/16}rem`}function de({sm:t,md:n,lg:s}){return{"@media (min-width:600px)":{fontSize:K(t)},"@media (min-width:900px)":{fontSize:K(n)},"@media (min-width:1200px)":{fontSize:K(s)}}}const Js="Public Sans, sans-serif",Ks="Barlow, sans-serif",Ys={fontFamily:Js,fontSecondaryFamily:Ks,fontWeightRegular:400,fontWeightMedium:500,fontWeightSemiBold:600,fontWeightBold:700,h1:{fontWeight:800,lineHeight:80/64,fontSize:K(40),...de({sm:52,md:58,lg:64})},h2:{fontWeight:800,lineHeight:64/48,fontSize:K(32),...de({sm:40,md:44,lg:48})},h3:{fontWeight:700,lineHeight:1.5,fontSize:K(24),...de({sm:26,md:30,lg:32})},h4:{fontWeight:700,lineHeight:1.5,fontSize:K(20),...de({sm:20,md:24,lg:24})},h5:{fontWeight:700,lineHeight:1.5,fontSize:K(18),...de({sm:19,md:20,lg:20})},h6:{fontWeight:700,lineHeight:28/18,fontSize:K(17),...de({sm:18,md:18,lg:18})},subtitle1:{fontWeight:600,lineHeight:1.5,fontSize:K(16)},subtitle2:{fontWeight:600,lineHeight:22/14,fontSize:K(14)},body1:{lineHeight:1.5,fontSize:K(16)},body2:{lineHeight:22/14,fontSize:K(14)},caption:{lineHeight:1.5,fontSize:K(12)},overline:{fontWeight:700,lineHeight:1.5,fontSize:K(12),textTransform:"uppercase"},button:{fontWeight:700,lineHeight:24/14,fontSize:K(14),textTransform:"unset"}};function Zs(){const t=E(M[500],.16);return{z1:`0 1px 2px 0 ${t}`,z4:`0 4px 8px 0 ${t}`,z8:`0 8px 16px 0 ${t}`,z12:`0 12px 24px -4px ${t}`,z16:`0 16px 32px -4px ${t}`,z20:`0 20px 40px -4px ${t}`,z24:`0 24px 48px 0 ${t}`,card:`0 0 2px 0 ${E(M[500],.08)}, 0 12px 24px -4px ${E(M[500],.08)}`,dropdown:`0 0 2px 0 ${E(M[500],.24)}, -20px 20px 40px -4px ${E(M[500],.24)}`,dialog:`-40px 40px 80px -8px ${E(qt.black,.24)}`,primary:`0 8px 16px 0 ${E(Lt.main,.24)}`,info:`0 8px 16px 0 ${E(Bt.main,.24)}`,secondary:`0 8px 16px 0 ${E(Ut.main,.24)}`,success:`0 8px 16px 0 ${E(Mt.main,.24)}`,warning:`0 8px 16px 0 ${E(Wt.main,.24)}`,error:`0 8px 16px 0 ${E(zt.main,.24)}`}}function Ht({children:t}){const n=i.useMemo(()=>({palette:Hs(),typography:Ys,shadows:Gs(),customShadows:Zs(),shape:{borderRadius:8}}),[]),s=An(n);return s.components=Vs(s),e.jsxs(Nn,{theme:s,children:[e.jsx(Ln,{}),t]})}Ht.propTypes={children:d.node};function Xs(){return zs(),e.jsx($s,{children:e.jsx(Ht,{children:e.jsx(Ws,{})})})}const Qs=Sn.createRoot(document.getElementById("root"));Qs.render(e.jsx(kn,{children:e.jsx(Rn,{children:e.jsx(i.Suspense,{children:e.jsx(Xs,{})})})}));function er(t){const n=typeof t<"u"?is(t).format("0.00a"):"";return et(n,".00")}function jt(t){const n=typeof t<"u"?`${(t/1e3/1e3*60).toFixed(2)} kw/h`:"";return et(n,"")}function be(t){const n=typeof t<"u"?`${(t/1e3*60).toFixed(2)} w/h`:"";return et(n,"")}function et(t,n){return t.includes(n)?t.replace(n,""):t}const tt=({title:t})=>e.jsx($,{direction:"row",sx:{justifyContent:"space-between",alignItems:"baseline"},children:e.jsx(P,{variant:"h4",children:t})});tt.propTypes={title:d.string};const tr=()=>{const t=je();return[t.palette.success.dark,t.palette.info.dark,t.palette.error.dark,t.palette.warning.dark,t.palette.primary.dark,t.palette.success.main,t.palette.info.main,t.palette.error.main,t.palette.primary.main,t.palette.warning.main,t.palette.success.light,t.palette.info.light,t.palette.error.light,t.palette.warning.light,t.palette.primary.light]},nr=Ie(Ze)(({theme:t})=>({"& .apexcharts-canvas":{"& .apexcharts-tooltip":{...Re({color:t.palette.background.default}),color:t.palette.text.primary,boxShadow:t.customShadows.dropdown,borderRadius:t.shape.borderRadius*1.25,"&.apexcharts-theme-light":{borderColor:"transparent",...Re({color:t.palette.background.default})}},"& .apexcharts-xaxistooltip":{...Re({color:t.palette.background.default}),borderColor:"transparent",color:t.palette.text.primary,boxShadow:t.customShadows.dropdown,borderRadius:t.shape.borderRadius*1.25,"&:before":{borderBottomColor:E(t.palette.grey[500],.24)},"&:after":{borderBottomColor:E(t.palette.background.default,.8)}},"& .apexcharts-tooltip-title":{textAlign:"center",fontWeight:t.typography.fontWeightBold,backgroundColor:E(t.palette.grey[500],.08),color:t.palette.text[t.palette.mode==="light"?"secondary":"primary"]},"& .apexcharts-legend":{padding:0},"& .apexcharts-legend-series":{display:"inline-flex !important",alignItems:"center"},"& .apexcharts-legend-marker":{marginRight:8},"& .apexcharts-legend-text":{lineHeight:"18px",textTransform:"capitalize"}}}));i.memo(nr);function ge({title:t,subtitle:n,icon:s,color:r="primary",sx:o,...l}){return e.jsxs(le,{component:$,spacing:3,direction:"row",sx:{px:3,py:5,borderRadius:2,...o},...l,children:[s&&e.jsx(O,{sx:{width:64,height:64},children:s}),e.jsxs($,{spacing:.5,children:[e.jsx(P,{variant:"h5",children:t}),e.jsx(P,{variant:"subtitle2",sx:{color:"text.disabled"},children:n})]})]})}ge.propTypes={color:d.string,icon:d.oneOfType([d.element,d.string]),sx:d.object,title:d.string,subtitle:d.string};function Gt(t,n){let s,r=0,o=!1;const l=[];for(let a=0;a<=3;a+=1)if(s=n[`switch:${a}`],typeof s?.aenergy?.by_minute<"u"){o=!0;const u=Number(s.aenergy.by_minute[0]);u>0&&(r+=u,l.push({label:`${t} switch:${a}`,value:u}))}if(s=n["rgbw:0"],typeof s?.aenergy?.by_minute<"u"){o=!0;const a=Number(s.aenergy.by_minute[0]);a>0&&(r+=a,l.push({label:`${t} rgbw:0`,value:a}))}return{hasSwitch:o,totalPower:r,powerPerDevice:l}}function sr(t){let n=0,s=0,r=0,o=0,l=0,a=[];const u=[];let x={totalPower:0,powerPerDevice:[]};return Object.values(t).forEach((c,f)=>{const h=c?.wsmessages?.NotifyFullStatus?.params;if(c.online&&(r+=1),typeof h<"u"&&(x=Gt(c.cname,h),x.totalPower>0&&u.push(c.chartColor),a=a.concat(x.powerPerDevice),l+=x.totalPower,typeof h?.cloud?.connected<"u"&&h.cloud.connected&&(o+=1),typeof c.scripts<"u")){let p;Object.values(c.scripts).forEach(b=>{p=h[`script:${b.id}`],p!=="undefined"&&(n+=1,p.running&&(s+=1),b.running=p.running)})}}),{currentPower:l,powerPerDevice:a,colorPerDevice:u,scriptsRunning:s,scriptsCount:n,cloudCount:o,onlineCount:r}}function rr({title:t,subheader:n,colors:s,powerPerDevice:r,...o}){const l=je(),a=[],u=[];r.forEach(c=>{a.push(c.label),u.push(c.value)});const x={chart:{id:"current-consumption"},labels:a,stroke:{colors:[l.palette.background.paper]},legend:{show:!0,position:"bottom"},colors:s,dataLabels:{enabled:!0,dropShadow:{enabled:!1}},tooltip:{fillSeriesColor:!1,shared:!0,intersect:!1,y:{formatter:c=>typeof c<"u"?be(c):c}}};return e.jsxs(le,{...o,children:[e.jsx(Ke,{title:t,subheader:n,sx:{mb:5}}),e.jsx(Ze,{type:"pie",series:u,options:x,width:"100%",height:280},JSON.stringify(r))]})}function or({title:t,subheader:n,chart:s,handleTimelineChange:r,selection:o,...l}){const{labels:a,colors:u,series:x,timeline:c,maxConsumption:f}=s,{t:h}=L(),p={colors:u,plotOptions:{bar:{columnWidth:"28%"}},chart:{stacked:c.data!=="Minute"},yaxis:{labels:{formatter(b){return c.data==="Minute"?f/1e3*60<1e3?be(b):jt(b):f/1e3<1e3?`${(b/1e3).toFixed(2)} w/h`:`${(b/1e3/1e3).toFixed(2)} kw/h`}},forceNiceScale:!0},xaxis:{type:"datetime",labels:{format:c.format,datetimeUTC:!1}},stroke:{width:3,curve:"smooth",lineCap:"round"},tooltip:{shared:!0,intersect:!1,x:{show:!0,format:c.format||"undefined"},y:{formatter(b){return c.data==="Minute"?f/1e3*60<9e3?be(b):jt(b):f/1e3<9e3?`${(b/1e3).toFixed(2)} w/h`:`${(b/1e3/1e3).toFixed(2)} kw/h`}}}};return e.jsxs(le,{...l,children:[e.jsx(Ke,{title:t,subheader:n,action:e.jsx(Ae,{sx:{m:1,minWidth:120},size:"small",children:e.jsxs(Un,{value:o,onChange:r,children:[e.jsx(W,{value:"0",children:h("_byminute_")}),e.jsx(W,{value:"1",children:h("_byhour_")}),e.jsx(W,{value:"2",children:h("_byday_")}),e.jsx(W,{value:"3",children:h("_bymonth_")}),e.jsx(W,{value:"4",children:h("_byyear_")})]})})}),e.jsx(O,{sx:{p:3,pb:1},children:e.jsx(Ze,{dir:"ltr",type:x[0].type,series:x,options:p,width:"100%",height:364})})]})}function ir(t){const n={};switch(t){case 1:n.data="Hour",n.format="HH:00",n.catformat="yyyy-MM-dd HH:00";break;case 2:n.data="Day",n.format="d.MM",n.catformat="yyyy-MM-dd";break;case 3:n.data="Month",n.format="MMM.yyyy",n.catformat="yyyy-MM";break;case 4:n.data="Year",n.format="yyyy",n.catformat="yyyy";break;default:n.data="Minute",n.format="H:mm",n.catformat="yyyy-MM-dd HH:mm"}return n}function ar(t,n,s){const r=[],o=[],l=[],a=[];let u=0;return n.forEach((x,c)=>{x.consumption>u&&(u=x.consumption);const f=Dt(x.ts,s.catformat);r.includes(f)||r.push(f);const h=l.indexOf(x.device_id);if(h===-1){const p=t.findIndex(b=>b.id===x.device_id);p!==-1?(l.push(x.device_id),a.push(t[p].chartColor),o.push({name:t[p].cname,type:s.data==="Minute"?"line":"bar",data:[{x:f,y:x.consumption}]})):console.error(`Could not finde device with id ${x.device_id}`)}else o[h].data.push({x:f,y:x.consumption})}),{labels:r,series:o,colors:a,maxConsumption:u}}function lr(){const[t,n]=i.useState(0),[s,r]=i.useState({running:0,count:0}),[o,l]=i.useState(0),[a,u]=i.useState([]),[x,c]=i.useState([]),[f,h]=i.useState({online:0,count:0}),[p,b]=i.useState({labels:[],colors:[],series:[],timeline:{},maxConsumption:0}),[j,C]=i.useState([]),{t:w}=L(),[v,k]=i.useState(0),g=i.useRef({data:"Minute",format:"HH:mm",catformat:"yyyy-MM-dd HH:mm"}),{user:T,request:R,subscribe:_,unsubscribe:S}=V(),F=tr(),I=i.useRef(m()),U=i.useCallback(z=>{let B;if(j.length!==0)B=j;else if(typeof z.data.devices<"u")B=z.data.devices;else return;const{rows:se}=z.data,Q=ar(B,se,g.current);B.length>0&&b({labels:Q.labels,colors:Q.colors,series:Q.series,timeline:g.current,maxConsumption:Q.maxConsumption})},[j]),A=i.useCallback(z=>{C(z);const B=sr(z);r({running:B.scriptsRunning,count:B.scriptsCount}),l(B.cloudCount),u(B.colorPerDevice),c(B.powerPerDevice),n(B.currentPower),h({online:B.onlineCount,count:z.length}),R({event:`getTimeline${g.current.data}`,data:{source:"App View",message:"App View needs timeline for a device"}},U)},[R,U]),J=i.useCallback(z=>{const B=z.data.device;if(z.event==="ShellyUpdate"&&z.type==="ws"){const se=j.map((Q,we)=>Q.id===B.id?(B.chartColor=F[ee(we+1,F.length)],B):Q);A(se)}},[A,j,F]),re=z=>{const B=Number(z.target.value);k(B),g.current=ir(B),R({event:`getTimeline${g.current.data}`,data:{source:"App View",message:"App View needs timeline for a device"}},U)},ve=i.useCallback(z=>{const B=z.data.devices.map((se,Q)=>(se.chartColor=F[ee(Q+1,F.length)],se));U(z),A(B)},[F,A,U]);return i.useEffect(()=>{const z=I.current;return j.length===0&&R({event:"devices timeline get",data:{source:"App View",message:"App View needs the list of devices and the timeline"}},ve),_({subscriptionID:z,callback:J,all:!0},["ShellyUpdate"]),()=>{S(z,["ShellyUpdate"])}},[j.length,ve,J,S,_,R]),j.length===0?null:e.jsxs(he,{maxWidth:"xl",children:[e.jsx($,{direction:"row",children:e.jsx(tt,{title:`${w("_welcome_")} ${T.firstname!==null?T.firstname:T.alias}`})}),e.jsxs(X,{container:!0,spacing:3,children:[e.jsx(X,{size:{xs:12,sm:6,md:3},children:e.jsx(ge,{title:`${f.online}/${f.count}`,subtitle:`Shellies ${w("Connected")}`,color:"success",icon:e.jsx("img",{alt:"icon",src:"/assets/icons/overview/S-Shelly-Icon.svg"})})}),e.jsx(X,{size:{xs:12,sm:6,md:3},children:e.jsx(ge,{title:be(t),subtitle:w("_consumption_"),color:"info",icon:e.jsx("img",{alt:"icon",src:"/assets/icons/overview/consumption.svg"})})}),e.jsx(X,{size:{xs:12,sm:6,md:3},children:e.jsx(ge,{title:`${s.running}/${s.count}`,subtitle:w("Running"),color:"success",icon:e.jsx("img",{alt:"icon",src:"/assets/icons/overview/script.svg"})})}),e.jsx(X,{size:{xs:12,sm:6,md:3},children:e.jsx(ge,{title:er(o),subtitle:w("Connected"),color:"error",icon:e.jsx("img",{alt:"icon",src:"/assets/icons/overview/cloud.svg"})})}),e.jsx(X,{size:{xs:12,sm:12,md:12,lg:12},children:e.jsx(rr,{title:w("_consumption_"),subheader:w("_perShelly_"),colors:a,powerPerDevice:x})}),e.jsx(X,{size:{xs:12,sm:12,md:12,lg:12},children:e.jsx(or,{title:"Timeline",subheader:w("_perShelly_"),chart:p,handleTimelineChange:re,selection:v})})]})]})}function cr(){const{user:t}=V();return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" Dashboard"})}),t?e.jsx(lr,{}):null]})}const dr=Object.freeze(Object.defineProperty({__proto__:null,default:cr},Symbol.toStringTag,{value:"Module"}));function Vt({handleContentChange:t,content:n}){const{t:s}=L(),r=["heading","bold","italic","strike","link","underline","code","orderedList","bulletList","align","codeBlock","blockquote","history","color"],o={editor:{editor:"Editor",preview:s("_editor-preview_")},toolbar:{bold:s("_editor-bold_"),italic:s("_editor-italic_"),strike:s("_editor-strike_"),underline:s("_editor-underline_"),link:s("_editor-link_"),bulletList:s("_editor-bulletlist_"),orderedList:s("_editor-orderedlist_"),alignLeft:s("_editor-alignleft_"),alignCenter:s("_editor-aligncenter_"),alignRight:s("_editor-alignright_"),alignJustify:s("_editor-alignjustify_"),blockquote:s("_editor-blockquote_"),codeBlock:s("_editor-codeblock_"),color:s("_editor-color_"),table:"Table",youtube:"Youtube",undo:s("_editor-undo_"),redo:s("_editor-redo_"),mention:"Mention"},headings:{normalText:s("_editor-normaltext_"),h1:s("_editor-h1_"),h2:s("_editor-h2_"),h3:s("_editor-h3_"),h4:s("_editor-h4_"),h5:s("_editor-h5_"),h6:s("_editor-h6_")},table:{table:"Tableau",addColumnBefore:"Ajouter une colonne avant",addColumnAfter:"Ajouter une colonne apr칟s",deleteColumn:"Supprimer la colonne",addRowBefore:"Ajouter une ligne avant",addRowAfter:"Ajouter une ligne apr칟s",deleteRow:"Supprimer la ligne",mergeCells:"Fusionner les cellules",splitCell:"Diviser la cellule",deleteTable:"Supprimer le tableau",insertTable:"Ins칠rer un tableau",toggleHeaderCell:"Basculer la cellule d'en-t칡te",toggleHeaderColumn:"Basculer la colonne d'en-t칡te",toggleHeaderRow:"Basculer la ligne d'en-t칡te",mergeOrSplit:"Fusionner ou diviser",setCellAttribute:"D칠finir l'attribut de cellule"},link:{link:s("_editor-link_"),insert:s("_editor-insertlink_"),invalid:s("_editor-invalidlink_")},youtube:{link:"Lien",insert:"Ins칠rer la vid칠o Youtube",title:"Ins칠rer une vid칠o Youtube",invalid:"Lien invalide",enter:"Entrer le lien",height:"Hauteur",width:"Largeur"}};return e.jsx("div",{children:e.jsx(ls,{value:n,onChange:t,toolbar:r,placeholder:s("_editor-placeholder_"),disableTabs:!0,toolbarPosition:"top",labels:o,withBubbleMenu:!1})})}Vt.propTypes={handleContentChange:d.func.isRequired,content:d.string};const Jt=({type:t,handleUpdatePost:n,updatepost:s,handleBlogpostsReceived:r})=>{const{user:o,request:l}=V(),[a,u]=i.useState(t==="update"?s:{title:"",content:"",public:0}),{t:x}=L(),[c,f]=i.useState({success:!0,message:""}),h=v=>{f({success:v.data.success,message:v.data.message}),v.data.success&&r(v)},p=v=>{f({success:v.data.success,message:v.data.message}),v.data.success&&n(a)},b=({target:v})=>{const k={...a};v.name==="public"?k.public=v.checked?1:0:k[v.name]=v.value,u(k)},j=v=>{const k={...a};k.content=v,u(k)},C=v=>{v.preventDefault(),t==="create"?(a.userid=o.id,a.createdAt=Date.now(),l({event:"blogpost create",data:{source:"Blogpost Form",message:"Blogpost Form wants to create a new post",blogpost:a}},h)):t==="update"&&l({event:"blogpost update",data:{source:"Blogpost Form",message:"Blogpost Form wants to update a post",blogpost:a}},p)},w=()=>typeof a.title>"u"||a.title.length===0||typeof a.content>"u"||a.content.length===0||Ct(s,a);return e.jsx("form",{onSubmit:C,children:e.jsx(Ae,{fullWidth:!0,size:"subtitle2",children:e.jsxs($,{spacing:3,sx:{px:3,py:3},children:[e.jsxs($,{direction:"row",spacing:3,children:[e.jsx(te,{required:!0,value:a.title,name:"title",label:x("Title"),slotProps:{htmlInput:{maxLength:40}},onChange:b,sx:{width:280}}),e.jsx(Te,{control:e.jsx(Bn,{name:"public",size:"medium",checked:a.public===1,onChange:b}),label:"Public",labelPlacement:"bottom"})]}),e.jsx(Vt,{handleContentChange:j,content:a.content}),e.jsx(P,{variant:"subtitle2",color:c.success?"success":"error",children:x(c.message)}),e.jsx(Y,{disabled:w(),fullWidth:!0,size:"large",type:"submit",color:"inherit",variant:"outlined",startIcon:e.jsx(y,{icon:"formkit:submit"}),children:x("Save")})]})})})};function Kt({openUpdate:t,updatepost:n,onCloseUpdate:s,handleUpdatePost:r}){const{t:o}=L();return e.jsxs(ae,{anchor:"right",open:t,onClose:s,slotProps:{paper:{sx:{width:1,border:"none",overflow:"auto"}}},children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{px:1,py:2},children:[e.jsx(P,{variant:"h6",sx:{ml:1},children:o("_editpost_")}),e.jsx(H,{onClick:s,children:e.jsx(y,{icon:"eva:close-fill"})})]}),e.jsx(ne,{}),e.jsx(Jt,{type:"update",handleUpdatePost:r,updatepost:n})]})}Kt.propTypes={openUpdate:d.bool.isRequired,updatepost:d.object,handleUpdatePost:d.func,onCloseUpdate:d.func.isRequired};function nt({blogpost:t,index:n,handleDeletePost:s}){const[r,o]=i.useState(null),[l,a]=i.useState(!1),[u,x]=i.useState(!1),[c,f]=i.useState(!1),[h,p]=i.useState(t),{t:b}=L(),{user:j}=V(),C=n===0,w=n===1||n===2,v=A=>{const J={...h};J.title=A.title,J.content=A.content,J.public=A.public,p(J)},k=A=>{o(A.currentTarget),f(!1)},g=()=>{o(null)},T=()=>{a(!1)},R=()=>{a(!0),o(null)},_=()=>{f(!0)},S=e.jsx(pe,{alt:h.author.name,src:h.author.avatarUrl,sx:{zIndex:9,width:32,height:32,position:"absolute",left:A=>A.spacing(3),bottom:A=>A.spacing(-2),...(C||w)&&{zIndex:9,top:24,left:24,width:40,height:40}}}),F=e.jsx(O,{sx:C||w?{position:"absolute",top:80,left:25}:{pl:3,pt:4},children:e.jsxs($,{children:[e.jsx(P,{variant:"caption",component:"div",sx:{mb:2,color:"text.disabled",...(C||w)&&{opacity:.48,color:"common.white"}},children:Os(h.createdAt)}),e.jsxs($,{direction:"row",spacing:2,children:[e.jsx(P,{color:"inherit",variant:"subtitle2",sx:{height:44,overflow:"hidden",WebkitLineClamp:2,display:"-webkit-box",WebkitBoxOrient:"vertical",...C&&{typography:"h5",height:60},...(C||w)&&{color:"common.white"}},children:h.title}),e.jsx(y,{icon:"mdi:text-box",onClick:()=>x(!u),sx:{cursor:"pointer",...(C||w)&&{color:"white"}}})]}),e.jsx(P,{variant:"caption",color:"inherit",sx:{...(C||w)&&{color:"common.white"}},children:e.jsx(dt,{value:`${h.content.substring(0,150)} ${h.content.length>150?"...":""}`})})]})}),I=e.jsx(O,{component:"img",alt:h.title,src:h.cover,sx:{top:0,width:1,height:1,objectFit:"cover",position:"absolute"}}),U=e.jsx(Qe,{color:"paper",src:"/assets/icons/shape-avatar.svg",sx:{width:80,height:36,zIndex:9,bottom:-15,position:"absolute",color:"background.paper",...(C||w)&&{display:"none"}}});return e.jsxs(X,{size:u?{xs:12,sm:12,md:12}:{xs:12,sm:C?12:6,md:C?6:3},children:[e.jsxs(le,{children:[e.jsxs(O,{sx:{position:"relative",pt:"calc(100% * 3 / 4)",...(C||w)&&{pt:"calc(100% * 4 / 3)","&:after":{top:0,content:"''",width:"100%",height:"100%",position:"absolute",bgcolor:A=>E(A.palette.grey[900],.72)}},...C&&{pt:{xs:"calc(100% * 4 / 3)",sm:"calc(100% * 3 / 4.66)"}}},children:[j!==null&&j.roleid<3&&e.jsx(H,{onClick:k,sx:{zIndex:9,position:"absolute",top:24,right:20,width:40,height:40},children:e.jsx(y,{icon:"eva:more-vertical-fill",color:"white"})}),U,S,I]}),F]}),u&&e.jsx(O,{sx:{m:3,display:"flex",width:1,overflowX:"auto",overflowY:"auto"},children:e.jsx(dt,{value:h.content})}),j!==null&&j.roleid<3&&e.jsxs(_e,{open:!!r,anchorEl:r,onClose:g,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{width:200}}},children:[e.jsxs(W,{onClick:R,children:[e.jsx(y,{icon:"eva:edit-fill",sx:{mr:2}}),b("Edit")]}),!c&&e.jsxs(W,{onClick:_,sx:{color:"error.main"},children:[e.jsx(y,{icon:"eva:trash-2-outline",sx:{mr:2}}),b("Delete")]}),c&&e.jsxs(W,{onClick:s,sx:{color:"error.main"},children:[e.jsx(y,{icon:"eva:question-mark-circle-outline",sx:{mr:2}}),b("_reallydelete_")]})]}),e.jsx(Kt,{title:b("_editpost_"),openUpdate:l,type:"update",updatepost:h,onCloseUpdate:T,handleUpdatePost:v})]})}nt.propTypes={blogpost:d.object.isRequired,index:d.number.isRequired,handleDeletePost:d.func};function Yt({openCreate:t,onOpenCreate:n,onCloseCreate:s,handleBlogpostsReceived:r}){const{t:o}=L();return e.jsxs(e.Fragment,{children:[e.jsx(Y,{variant:"contained",color:"inherit",startIcon:e.jsx(y,{icon:"eva:plus-fill"}),onClick:n,children:o("_newpost_")}),e.jsxs(ae,{anchor:"right",open:t,onClose:s,slotProps:{paper:{sx:{width:1,border:"none",overflow:"auto"}}},children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{px:1,py:2},children:[e.jsx(P,{variant:"h6",sx:{ml:1},children:o("_newpost_")}),e.jsx(H,{onClick:s,children:e.jsx(y,{icon:"eva:close-fill"})})]}),e.jsx(ne,{}),e.jsx(Jt,{type:"create",handleBlogpostsReceived:r})]})]})}Yt.propTypes={openCreate:d.bool.isRequired,onOpenCreate:d.func.isRequired,onCloseCreate:d.func.isRequired,handleBlogpostsReceived:d.func.isRequired};function ur(){const[t,n]=i.useState([]),{request:s,user:r}=V(),o=i.useRef(!1),[l,a]=i.useState(!1),u=i.useCallback(h=>{o.current=!0;const p=h.data.blogposts.map((b,j)=>({id:b.blogpostid,cover:`/assets/images/covers/cover_${ee(j+1,24)}.jpg`,title:b.title,content:b.content,createdAt:b.createdAt,public:b.public,author:{name:b.alias,avatarUrl:`/assets/images/avatars/avatar_${ee(b.userid,25)}.jpg`}}));n(p)},[n]);i.useEffect(()=>{o.current||s({event:"blogposts get all",data:{source:"Blog View",message:"Blog View  needs the list of blogposts"}},u)},[u,s]);const x=()=>{a(!0)},c=()=>{a(!1)},f=h=>{s({event:"blogpost delete",data:{source:"Blog View",message:"Blog View wants to delete a post",ids:[h]}},u)};return e.jsxs(he,{children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(P,{variant:"h4",children:"Blog"}),r.roleid<3&&e.jsx(Yt,{openCreate:l,onOpenCreate:x,onCloseCreate:c,handleBlogpostsReceived:u})]}),e.jsx(X,{container:!0,spacing:3,children:t.map((h,p)=>e.jsx(nt,{blogpost:h,index:p,handleDeletePost:b=>f(h.id)},m()))})]})}function pr(){const{user:t}=V();return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" Blog"})}),t?e.jsx(ur,{}):null]})}const hr=Object.freeze(Object.defineProperty({__proto__:null,default:pr},Symbol.toStringTag,{value:"Module"}));function Zt({openCreate:t,onOpenCreate:n,onCloseCreate:s,handleUsersReceived:r}){const{t:o}=L();return e.jsxs(e.Fragment,{children:[e.jsx(Y,{variant:"contained",color:"inherit",startIcon:e.jsx(y,{icon:"eva:plus-fill"}),onClick:n,children:o("_newuser_")}),e.jsxs(ae,{anchor:"right",open:t,onClose:s,slotProps:{paper:{sx:{width:300,border:"none",overflow:"hidden"}}},children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{px:1,py:2},children:[e.jsx(P,{variant:"h6",sx:{ml:1},children:o("_newuser_")}),e.jsx(H,{onClick:s,children:e.jsx(y,{icon:"eva:close-fill"})})]}),e.jsx(ne,{}),e.jsx(Ue,{type:"create",handleUsersReceived:r})]})]})}Zt.propTypes={openCreate:d.bool.isRequired,onOpenCreate:d.func.isRequired,onCloseCreate:d.func.isRequired,handleUsersReceived:d.func.isRequired};function Xt({query:t}){const{t:n}=L();return e.jsx(Ne,{children:e.jsx(Z,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(Mn,{sx:{textAlign:"center"},children:[e.jsx(P,{variant:"h6",paragraph:!0,children:n("_notfound_")}),e.jsxs(P,{variant:"body2",children:[n("_noresultsfor_")," ",e.jsxs("strong",{children:['"',t,'"']}),"."]})]})})})}Xt.propTypes={query:d.string};const xr=({updateuser:t={updateuser:t}})=>{const{t:n}=L(),{request:s,devices:r}=V(),[o,l]=i.useState([]),[a,u]=i.useState({success:!0,message:""}),x=p=>{u({success:p.data.success,message:p.data.message})},c=p=>{p.preventDefault(),s({event:"user devices update",data:{source:"Devices Form",message:`Updating the devices of user ${t.alias}`,userid:t.id,userdevices:o}},x)},f=i.useCallback(p=>{l(p.data.userdevices)},[]),h=p=>{const b=[...o];b.includes(p)?b.splice(b.findIndex(j=>j===p),1):b.push(p),l(b)};return i.useEffect(()=>{s({event:"user devices get all",data:{source:"Devices Form",message:"Devices Form needs the list of devices of a user",userid:t.id}},f)},[f,s,t]),e.jsx(O,{component:"form",onSubmit:c,sx:{height:1},children:e.jsxs($,{direction:"column",sx:{justifyContent:"space-between",m:2,height:1},children:[e.jsx(Ae,{fullWidth:!0,size:"subtitle2",children:e.jsx($,{spacing:.5,sx:{maxHeight:"99%",overflowY:"auto"},children:r.map((p,b)=>e.jsx(Te,{value:p.id,control:e.jsx(me,{checked:o.includes(p.id)}),onChange:()=>h(p.id),label:p.cname},p.id))})}),e.jsx(P,{variant:"subtitle2",color:a.success?"success":"error",children:n(a.message)}),e.jsx(Y,{fullWidth:!0,size:"large",type:"submit",color:"inherit",variant:"outlined",startIcon:e.jsx(y,{icon:"formkit:submit"}),children:n("Save")})]})})};function gr({title:t,updateuser:n,openDevices:s,onCloseDevices:r}){return e.jsxs(ae,{anchor:"right",open:s,onClose:r,slotProps:{paper:{sx:{width:300,border:"none",overflow:"hidden"}}},children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{px:1,py:2},children:[e.jsx(P,{variant:"h6",sx:{ml:1},children:`${t}: ${n.alias}`}),e.jsx(H,{onClick:r,children:e.jsx(y,{icon:"eva:close-fill"})})]}),e.jsx(ne,{}),e.jsx(xr,{updateuser:n})]})}function fr({id:t,selected:n,alias:s,avatarUrl:r,firstname:o,lastname:l,roleid:a,role:u,email:x,home:c,handleClick:f,handleDeleteUser:h,handleUpdateUser:p}){const[b,j]=i.useState(null),[C,w]=i.useState(!1),{t:v}=L(),[k,g]=i.useState({open:!1,type:""}),[T,R]=i.useState({open:!1}),_=re=>{I(),g({open:!0,type:re})},S=()=>{g({open:!1,type:""})},F=re=>{j(re.currentTarget),w(!1)},I=()=>{j(null)},U=()=>{w(!0)},A=()=>{I(),R({open:!0})},J=()=>{R({open:!1})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[e.jsx(Z,{padding:"checkbox",children:a!==1&&e.jsx(me,{disableRipple:!0,checked:n,onChange:f})}),e.jsx(Z,{component:"th",scope:"row",padding:"none",children:e.jsxs($,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(pe,{alt:s,src:r}),e.jsx(P,{variant:"subtitle2",noWrap:!0,children:s})]})}),e.jsx(Z,{children:o}),e.jsx(Z,{children:l}),e.jsx(Z,{children:u}),e.jsx(Z,{children:x}),e.jsx(Z,{children:c}),e.jsx(Z,{align:"right",children:e.jsx(H,{onClick:F,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})})]}),e.jsxs(_e,{open:!!b,anchorEl:b,onClose:I,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{width:200}}},children:[e.jsxs(W,{onClick:()=>_("profile"),children:[e.jsx(y,{icon:"eva:edit-fill",sx:{mr:2}}),v("Edit")]}),a!==1&&e.jsxs(W,{onClick:()=>A(),children:[e.jsx(y,{icon:"eva:edit-fill",sx:{mr:2}}),v("_assigndevices_")]}),!C&&a!==1&&e.jsxs(W,{onClick:U,sx:{color:"error.main"},children:[e.jsx(y,{icon:"eva:trash-2-outline",sx:{mr:2}}),v("Delete")]}),C&&e.jsxs(W,{onClick:h,sx:{color:"error.main"},children:[e.jsx(y,{icon:"eva:question-mark-circle-outline",sx:{mr:2}}),v("_reallydelete_")]})]}),e.jsx(It,{title:v("_edituserprofile_"),openUpdate:k.open,type:k.type,updateuser:{alias:s,email:x,firstname:o,lastname:l,home:c,id:t,roleid:a,role:u},onCloseUpdate:S,handleUpdateUser:p}),e.jsx(gr,{title:v("_assigndevices_"),updateuser:{alias:s,firstname:o,lastname:l,id:t},openDevices:T.open,onCloseDevices:J})]})}const mr={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function br(t,n,s){return t?Math.max(0,(1+t)*n-s):0}function _t(t,n,s){return t[s]===null?1:n[s]===null||n[s]<t[s]?-1:n[s]>t[s]?1:0}function jr(t,n){return t==="desc"?(s,r)=>_t(s,r,n):(s,r)=>-_t(s,r,n)}function _r({inputData:t,comparator:n,filterName:s,field:r}){const o=t.map((l,a)=>[l,a]);return o.sort((l,a)=>{const u=n(l[0],a[0]);return u!==0?u:l[1]-a[1]}),t=o.map(l=>l[0]),s&&(t=t.filter(l=>l[r].toLowerCase().indexOf(s.toLowerCase())!==-1)),t}function Qt({order:t,orderBy:n,rowCount:s,headLabel:r,numSelected:o,onRequestSort:l,onSelectAllClick:a}){const u=x=>c=>{l(c,x)};return e.jsx(Wn,{children:e.jsxs(Ne,{children:[e.jsx(Z,{padding:"checkbox",children:e.jsx(me,{indeterminate:o>0&&o<s,checked:s>0&&o===s,onChange:a})}),r.map(x=>e.jsx(Z,{align:x.align||"left",sortDirection:n===x.id?t:!1,sx:{width:x.width,minWidth:x.minWidth},children:e.jsxs(zn,{hideSortIcon:!0,active:n===x.id,direction:n===x.id?t:"asc",onClick:u(x.id),children:[x.label,n===x.id?e.jsx(O,{sx:{...mr},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},x.id))]})})}Qt.propTypes={order:d.oneOf(["asc","desc"]),orderBy:d.string,rowCount:d.number,headLabel:d.array,numSelected:d.number,onRequestSort:d.func,onSelectAllClick:d.func};function en({emptyRows:t,height:n}){return t?e.jsx(Ne,{sx:{...n&&{height:n*t}},children:e.jsx(Z,{colSpan:9})}):null}en.propTypes={emptyRows:d.number,height:d.number};function tn({selected:t,filterName:n,onFilterName:s,placeholder:r,handleDeleteSelected:o,showReallyDelete:l,handleShowReallyDelete:a}){const{t:u}=L();return e.jsxs(wt,{sx:{height:96,display:"flex",justifyContent:"space-between",p:x=>x.spacing(0,1,0,3),...t.length>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t.length>0?e.jsxs(P,{component:"div",variant:"subtitle1",children:[t.length," ",u("selected")]}):e.jsx(qn,{value:n,onChange:s,placeholder:r,startAdornment:e.jsx(We,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled",width:20,height:20}})})}),t.length>0&&!l&&e.jsx(Je,{title:u("Delete"),children:e.jsx(H,{onClick:()=>a(!0),children:e.jsx(y,{icon:"eva:trash-2-fill"})})}),t.length>0&&l&&e.jsx(Y,{color:"error",variant:"contained",startIcon:e.jsx(y,{icon:"eva:question-mark-circle-outline"}),onClick:()=>{o(),a(!1)},children:e.jsx(P,{variant:"subtitle1",children:u("_reallydelete_")})})]})}tn.propTypes={selected:d.array,filterName:d.string,onFilterName:d.func,placeholder:d.string,handleDeleteSelected:d.func,showReallyDelete:d.bool,handleShowReallyDelete:d.func};function yr(){const[t,n]=i.useState(0),[s,r]=i.useState([]),[o,l]=i.useState("asc"),[a,u]=i.useState([]),[x,c]=i.useState("name"),[f,h]=i.useState(""),[p,b]=i.useState(5),{t:j}=L(),{request:C}=V(),[w,v]=i.useState(!1),k=i.useRef(!1),[g,T]=i.useState(!1),R=D=>{const G=D.data.users.map((q,Jr)=>({id:q.userid,avatarUrl:`/assets/images/avatars/avatar_${ee(q.userid,25)}.jpg`,alias:q.alias,firstname:q.firstname,lastname:q.lastname,role:q.rolename,email:q.email,home:q.home,roleid:q.roleid}));k.current=!0,r(G)},_=i.useCallback(D=>{const N=[...s],G=N.findIndex(q=>q.id===D.id);N[G]=D,N[G].avatarUrl=`/assets/images/avatars/avatar_${ee(D.id,25)}.jpg`,r(N)},[s]),S=i.useCallback(D=>{D!==null&&_(D.detail)},[_]);i.useEffect(()=>{St("userUpdated",S),k.current||C({event:"users get all",data:{source:"Users View",message:"User View needs the list of users"}},R)},[C,S]);const F=()=>{v(!0)},I=()=>{v(!1)},U=D=>{T(D)},A=(D,N)=>{N!==""&&(l(x===N&&o==="asc"?"desc":"asc"),c(N))},J=D=>{if(D.target.checked){const N=s.filter(G=>G.id!==1).map(G=>G.alias);u(N);return}u([]),T(!1)},re=(D,N)=>{const G=a.indexOf(N);let q=[];G===-1?q=q.concat(a,N):G===0?q=q.concat(a.slice(1)):G===a.length-1?q=q.concat(a.slice(0,-1)):G>0&&(q=q.concat(a.slice(0,G),a.slice(G+1))),u(q),T(!1)},ve=D=>{C({event:"user delete",data:{source:"Users View",message:"User View wants to delete a user",ids:[D]}},R)},z=()=>{const D=s.filter(N=>a.includes(N.alias)&&N.id!==1).map(N=>N.id);u([]),C({event:"user delete",data:{source:"Users View",message:"User View wants to delete users",ids:D}},R)},B=(D,N)=>{n(N)},se=D=>{n(0),b(parseInt(D.target.value,10))},Q=D=>{n(0),h(D.target.value)},we=_r({inputData:s,comparator:jr(o,x),filterName:f,field:"alias"}),vn=!we.length&&!!f;return e.jsxs(he,{children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(P,{variant:"h4",children:j("Users")}),e.jsx(Zt,{openCreate:w,onOpenCreate:F,onCloseCreate:I,handleUsersReceived:R})]}),e.jsxs(le,{children:[e.jsx(tn,{selected:a,filterName:f,onFilterName:Q,placeholder:j("_searchuser_"),handleDeleteSelected:z,showReallyDelete:g,handleShowReallyDelete:U}),e.jsx(Le,{children:e.jsx(Hn,{sx:{overflow:"unset"},children:e.jsxs(Gn,{sx:{minWidth:800},children:[e.jsx(Qt,{order:o,orderBy:x,rowCount:s.length,numSelected:a.length,onRequestSort:A,onSelectAllClick:J,headLabel:[{id:"alias",label:j("Alias")},{id:"firstname",label:j("Firstname")},{id:"lastname",label:j("Lastname")},{id:"role",label:j("Role")},{id:"email",label:j("Email")},{id:"home",label:j("Home")},{id:""}]}),e.jsxs(Vn,{children:[we.slice(t*p,t*p+p).map(D=>e.jsx(fr,{id:D.id,alias:D.alias,firstname:D.firstname,lastname:D.lastname,role:D.role,email:D.email,home:D.home,roleid:D.roleid,avatarUrl:D.avatarUrl,selected:a.indexOf(D.alias)!==-1,handleClick:N=>re(N,D.alias),handleDeleteUser:N=>ve(D.id),handleUpdateUser:_},D.id)),e.jsx(en,{height:77,emptyRows:br(t,p,s.length)}),vn&&e.jsx(Xt,{query:f})]})]})})}),e.jsx(Jn,{page:t,component:"div",count:s.length,rowsPerPage:p,onPageChange:B,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:se,labelRowsPerPage:j("_rowsperpage_"),labelDisplayedRows:({from:D,to:N,count:G})=>`${D}${N} ${j("of")} ${G!==-1?G:`${j("_morethan_")} ${N}`}`})]})]})}function vr(){const{user:t}=V();return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" User"})}),t?e.jsx(yr,{}):null]})}const wr=Object.freeze(Object.defineProperty({__proto__:null,default:vr},Symbol.toStringTag,{value:"Module"}));function Cr(){const t=["Plus1PM","Plus1PMMini","PlusI4","PlusRGBWPM","SHBDUO-1","SHPLG-S"],[n,s]=i.useState(0),r=(o,l)=>{s(o)};return e.jsx("div",{children:e.jsx(as,{index:n,onChange:r,interval:4e3,animation:"fade",indicators:!0,stopAutoPlayOnHover:!0,children:t.map((o,l)=>e.jsx(O,{component:"img",src:`/assets/images/devices/${o}.png`,sx:{width:200,hight:200,objectFit:"scale-down"}},m()))})})}function Sr(){const t=je();return e.jsx(O,{display:"flex",justifyContent:"center",alignItems:"center",sx:{...Ts({color:E(t.palette.background.default,.9),imgUrl:"/assets/background/overlay_4.jpg"}),height:1},children:e.jsx(le,{sx:{p:5,width:1,maxWidth:420},children:e.jsxs($,{sx:{alignItems:"center",justifyContent:"center",height:1},children:[e.jsx(ye,{sx:{mt:3}}),e.jsx(Cr,{}),e.jsx(Ue,{type:"login"})]})})})}function kr(){return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" Login"})}),e.jsx(Sr,{})]})}const $r=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"}));function Pr(){const[t,n]=i.useState([]),{request:s}=V(),r=i.useRef(!1),o=Ee(),l=i.useCallback(u=>{if(r.current=!0,u.data.blogposts.length>0){const x=u.data.blogposts.map((c,f)=>({id:c.blogpostid,cover:`/assets/images/covers/cover_${ee(f+1,24)}.jpg`,title:c.title,content:c.content,createdAt:c.createdAt,view:23,comment:45,share:45,favorite:5,author:{name:c.alias,avatarUrl:`/assets/images/avatars/avatar_${ee(c.userid,25)}.jpg`}}));n(x)}else o("/login")},[n,o]);i.useEffect(()=>{r.current||s({event:"blogposts get public",data:{name:"LandingView",message:"LandingView  needs the list of public blogposts"}},l)},[l,s]);const a=()=>{o("/login")};return e.jsxs(he,{children:[e.jsx(O,{sx:{flexGrow:1},children:e.jsxs($,{direction:"row",spacing:10,sx:{justifyContent:"space-between"},children:[e.jsx(ye,{sx:{mt:3}}),e.jsx($,{direction:"row",sx:{alignItems:"center"},children:e.jsxs(H,{onClick:a,sx:{pt:3},"aria-label":"Login",children:[e.jsx(y,{icon:"eva:lock-fill"}),e.jsx(P,{variant:"h6",children:"Login"})]})})]})}),e.jsx(X,{container:!0,spacing:3,sx:{pt:5},children:t.map((u,x)=>e.jsx(nt,{blogpost:u,index:x},m()))})]})}function Fr(){return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" S-Central"})}),e.jsx(Pr,{})]})}const Rr=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"}));function Tr(t,n){return t.sort((s,r)=>s[n]-r[n])}function Or(t,n){return t.sort((s,r)=>s[n].localeCompare(r[n]))}const nn=({online:t})=>e.jsx(y,{icon:t?"material-symbols:wifi":"material-symbols:wifi-off",sx:{color:t?"green":"red"}});nn.propTypes={online:d.bool.isRequired};function sn({ip:t,switches:n,handleClick:s}){return typeof n>"u"?null:n.map((r,o)=>(r.ip=t,r.index=o,e.jsx(Je,{title:`Switch ${r.id}`,children:e.jsx(y,{icon:"icomoon-free:switch",sx:{cursor:"pointer",color:r.output?"green":"black"},onClick:()=>s(r)},m())},m())))}sn.propTypes={ip:d.string.isRequired,switches:d.array,handleClick:d.func.isRequired};const rn=({device:t,handleSwitchToggle:n})=>{const[s,r]=i.useState(t.switches),o=l=>{l.output=!l.output,t.switches[l.index]=l,r([...t.switches]),n(l)};return e.jsxs(e.Fragment,{children:[e.jsxs($,{direction:"row",sx:{minHeight:35,maxHeight:35,pr:1,pl:1,alignItems:"center",justifyContent:"space-between"},children:[e.jsx(nn,{online:t.online}),e.jsx(sn,{ip:t.ip,switches:s,handleClick:o})]}),e.jsx(Ke,{title:e.jsx(Ve,{href:`http://${t.ip}`,target:"_blank",color:"inherit",underline:"hover",children:t.cname}),subheader:`${t.name} ${t.gen>0?`(Gen ${t.gen})`:""}`,sx:{minWidth:200,minHeight:50,maxHeight:50,pt:1}}),e.jsx(Kn,{sx:{minWidth:160,maxWidth:160,minHeight:120,objectFit:"scale-down"},image:t.image,title:t.name,component:"img",alt:t.name})]})},Dr=i.memo(rn);rn.propTypes={device:d.object.isRequired,handleSwitchToggle:d.func.isRequired};const on=({scripts:t})=>typeof t>"u"?null:t.map(n=>n?.logmessages?.length>0?e.jsxs($,{spacing:0,children:[e.jsx(P,{variant:"subtitle2",children:n.name},m()),n.logmessages.map(s=>{const r=new Date(s.ts*1e3).toTimeString().substring(0,8);return e.jsxs($,{direction:"row",spacing:1,sx:{minWidth:0},children:[e.jsx(P,{variant:"caption",children:r},m()),e.jsx(P,{variant:"caption",noWrap:!0,children:s.msg},m())]},m())})]},m()):null),Er=i.memo(on);on.propTypes={scripts:d.array.isRequired};const Ir=i.forwardRef(({colors:t,selected:n,onSelectColor:s,limit:r="auto",sx:o,...l},a)=>{const u=typeof n=="string",x=i.useCallback(c=>{if(u)c!==n&&s(c);else{const f=n.includes(c)?n.filter(h=>h!==c):[...n,c];s(f)}},[s,n,u]);return e.jsx($,{ref:a,direction:"row",display:"inline-flex",sx:{flexWrap:"wrap",...r!=="auto"&&{width:r*36,justifyContent:"flex-end"},...o},...l,children:t.map(c=>{const f=u?n===c:n.includes(c);return e.jsx(Yn,{sx:{width:36,height:36,borderRadius:"50%"},onClick:()=>{x(c)},children:e.jsx($,{alignItems:"center",justifyContent:"center",sx:{width:20,height:20,bgcolor:c,borderRadius:"50%",border:h=>`solid 1px ${E(h.palette.grey[500],.16)}`,...f&&{transform:"scale(1.3)",boxShadow:`4px 4px 8px 0 ${E(c,.48)}`,outline:`solid 2px ${E(c,.08)}`,transition:h=>h.transitions.create("all",{duration:h.transitions.duration.shortest})}},children:e.jsx(y,{width:f?12:0,icon:"eva:checkmark-fill",sx:{color:h=>h.palette.getContrastText(c),transition:h=>h.transitions.create("all",{duration:h.transitions.duration.shortest})}})})},c)})})});Ir.propTypes={colors:d.oneOfType([d.string,d.arrayOf(d.string)]),limit:d.number,onSelectColor:d.func,selected:d.oneOfType([d.string,d.arrayOf(d.string)]),sx:d.object};function st({colors:t,limit:n=3,sx:s}){const r=t.slice(0,n),o=t.length-n;return e.jsxs($,{component:"span",direction:"row",alignItems:"center",justifyContent:"flex-end",sx:s,children:[r.map((l,a)=>e.jsx(O,{sx:{ml:-.75,width:16,height:16,bgcolor:l,borderRadius:"50%",border:u=>`solid 2px ${u.palette.background.paper}`,boxShadow:u=>`inset -1px 1px 2px ${E(u.palette.common.black,.24)}`}},l+a)),t.length>n&&e.jsx(O,{component:"span",sx:{typography:"subtitle2"},children:`+${o}`})]})}st.propTypes={colors:d.arrayOf(d.string),limit:d.number,sx:d.object};const yt=["#00AB55","#D22B2B","#000000"];function an({kvs:t}){return t.map((n,s)=>{const r=typeof n.display<"u"?n.display:n.key,o=l=>{switch(typeof n.style<"u"?n.style:n.value){case"boolean":return Number(n.value)===1?"true":"false";case"color":return e.jsx(st,{colors:Number(n.value)===1?yt.slice(0,1):yt.slice(1,2),sx:{pt:"5px"}},m());default:return n.value}};return e.jsxs($,{direction:"row",justifyContent:"space-between",style:{gap:20},useFlexGap:!0,flexWrap:"wrap",children:[e.jsx(P,{variant:"caption",sx:{minWidth:100},children:r},m()),e.jsx(P,{variant:"caption",children:o()},m())]},m())})}an.propTypes={kvs:d.array.isRequired};const ln=({device:t,handleSwitchSet:n})=>{const[s,r]=i.useState(t.switches),{t:o}=L(),l=s.find(k=>typeof k.brightness<"u"),a=s.find(k=>typeof k.white<"u"),u=s.find(k=>typeof k.rgb<"u"),[x,c]=i.useState(typeof u<"u"?`rgb (${u.rgb[0]}, ${u.rgb[1]}, ${u.rgb[2]})`:"rgb (255, 0, 0)"),[f,h]=i.useState(typeof l<"u"?l.brightness:0),[p,b]=i.useState(typeof a<"u"?a.white:0),j=i.useMemo(()=>cs(n,30,{leading:!1,trailing:!0}),[n]),C=(k,g)=>{c(k),u.ip=t.ip,u.rgb=g.rgb,j(u)},w=(k,g)=>{h(g),l.ip=t.ip,l.brightness=g,j(l)},v=(k,g)=>{b(g),a.ip=t.ip,a.white=g,j(a)};return i.useEffect(()=>{r(t.switches)},[t,r]),e.jsxs($,{alignItems:"flex-start",children:[typeof l<"u"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"subtitle",children:o("Brightness")}),e.jsx(at,{value:f,min:0,max:100,step:10,marks:!0,valueLabelDisplay:"auto",size:"small",onChange:w,"aria-label":"Brighness slider"})]}),typeof a<"u"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"subtitle",children:o("White")}),e.jsx(at,{value:p,min:0,max:t.gen===1?100:255,step:t.gen===1?10:25,marks:!0,valueLabelDisplay:"auto",size:"small",onChange:v,"aria-label":"White slider"})]}),typeof u<"u"&&e.jsx(hs,{format:"rgb",isAlphaHidden:!0,value:x,onChange:C,size:"small",variant:"outlined","aria-label":"Color Selection",sx:{pt:1}})]})};ln.propTypes={device:d.object,handleSwitchSet:d.func};const qe=({white:t})=>e.jsxs($,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:.5,children:[e.jsx(y,{icon:"stash:circle-dot"},m()),e.jsx(P,{variant:"caption",children:t},m())]},m());qe.propTypes={white:d.number};const cn=({data:t})=>{if(typeof t.motion<"u")return e.jsx(y,{icon:Number(t.motion)===1?"material-symbols:directions-walk":"fa6-solid:person",sx:{color:Number(t.motion)===1?"blue":"black"}},m());if(typeof t.window<"u")return Number(t.window)===1?e.jsx(y,{icon:"material-symbols:door-open-rounded",sx:{color:"black"}},m()):e.jsx(y,{icon:"material-symbols:door-front-rounded",sx:{color:"black"}},m());if(typeof t.button<"u")switch(Number(t.button)){case 1:return e.jsx(y,{icon:"mdi:number-1-box",sx:{color:"blue"}},m());case 2:return e.jsx(y,{icon:"mdi:number-2-box",sx:{color:"blue"}},m());case 3:return e.jsx(y,{icon:"mdi:number-3-box",sx:{color:"blue"}},m());case 4:return e.jsx(y,{icon:"mdi:number-4-box",sx:{color:"blue"}},m());case 254:return e.jsx(y,{icon:"f7:hand-point-left-fill",sx:{color:"blue"}},m());default:return e.jsx(y,{icon:"f7:hand-point-left-fill",sx:{color:"blue"}},m())}return e.jsx(y,{icon:"material-symbols:event-busy",sx:{color:"black"}},m())};cn.propTypes={data:d.object.isRequired};const dn=({event:t})=>{let n;switch(Number(t.id)){case 0:n=180;break;case 1:n=270;break;case 2:n=90;break;default:n=0}return e.jsxs($,{direction:"row",children:[e.jsx(y,{icon:"system-uicons:grid-squares-add",sx:{color:"black"},className:`rotate${n}`},m()),t.event==="single_push"&&e.jsx(y,{icon:"mdi:number-1-box",sx:{color:"blue"}},m()),t.event==="double_push"&&e.jsx(y,{icon:"mdi:number-2-box",sx:{color:"blue"}},m()),t.event==="triple_push"&&e.jsx(y,{icon:"mdi:number-3-box",sx:{color:"blue"}},m()),(t.event==="long_push"||t.event==="btn_up")&&e.jsx(y,{icon:"f7:hand-point-left-fill",sx:{color:"blue"}},m())]},m())};dn.propTypes={event:d.object.isRequired};const un=({events:t})=>{const n=t.map(s=>s.event==="shelly-blu"&&typeof s.data<"u"?e.jsx(cn,{data:s.data},m()):["single_push","double_push","triple_push","long_push"].includes(s.event)?e.jsx(dn,{event:s},m()):s.event==="btn_up"||s.event==="btn_down"?null:s.event==="scheduled_restart"?e.jsx(y,{icon:"solar:restart-square-bold",sx:{color:"black"}},m()):e.jsx(y,{icon:"ic:sharp-help",sx:{color:"black"}},m()));return n.length>0?n:e.jsx(y,{icon:"mdi:bug",sx:{color:"red"}},m())};un.propTypes={events:d.array.isRequired};const He=({consume:t})=>e.jsxs($,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:.5,children:[e.jsx(y,{icon:"material-symbols-light:bolt",sx:{color:+(t>0)?"blue":"black"}},m()),e.jsx(P,{variant:"caption",children:be(t)},m())]},m());He.propTypes={consume:d.number.isRequired};const pn=({params:t})=>{const n=[];return Object.keys(t).forEach(r=>{if(r.startsWith("script")){const o=t[r];n.push(e.jsxs($,{justifyContent:"flex-start",alignItems:"center",spacing:.5,direction:"row",children:[e.jsxs(P,{variant:"subtitle2",color:o.running?"green":"red",children:["{",o.id,"}"]},m()),e.jsxs(P,{variant:"caption",children:[Math.round(Number(o.mem_free)/1024)," kb free"]},m())]},m()))}}),n};pn.propTypes={params:d.object.isRequired};const hn=({version:t})=>e.jsxs($,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:.5,children:[e.jsx(y,{icon:"material-symbols:system-update-alt",sx:{color:"green"}},m()),e.jsx(P,{variant:"caption",children:t},m())]},m());hn.propTypes={version:d.string.isRequired};const Ge=({brightness:t})=>e.jsxs($,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:.5,children:[e.jsx(y,{icon:"subway:black-white",width:18,height:18},m()),e.jsxs(P,{variant:"caption",children:[t,"%"]},m())]},m());Ge.propTypes={brightness:d.number};const xn=({sys:t})=>e.jsxs($,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:.5,children:[e.jsx(y,{icon:"material-symbols-light:sd",sx:{color:"black"}},m()),e.jsxs(P,{variant:"caption",children:[Math.round(Number(t.ram_free)/1024)," kb free"]},m()),e.jsx(y,{icon:"material-symbols:storage-rounded",sx:{color:"black"}},m()),e.jsxs(P,{variant:"caption",children:[Math.round(Number(t.fs_free)/1024)," kb free"]},m())]},m());xn.propTypes={sys:d.object.isRequired};const gn=({deviceName:t,wsMessage:n})=>{const{params:s}=n;if(typeof s>"u")return[];const r=[];let o;if(n.method!=="NotifyEvent"&&(o=Gt(t,s)),n.method==="NotifyFullStatus"){if(typeof s?.sys<"u"&&r.push(e.jsx(xn,{sys:s.sys},m())),typeof s?.cloud?.connected<"u"&&r.push(e.jsx(y,{icon:"material-symbols-light:cloud",sx:{color:s.cloud.connected?"green":"black"}},m())),typeof s?.sys?.available_updates?.stable?.version<"u"&&r.push(e.jsx(hn,{version:s.sys.available_updates.stable.version},m())),r.push(e.jsx(pn,{params:n.params},m())),o.hasSwitch&&r.push(e.jsx(He,{consume:o.totalPower},m())),typeof s["rgbw:0"]?.brightness<"u"&&r.push(e.jsx(Ge,{brightness:s["rgbw:0"].brightness},m())),typeof s["switch:0"]?.brightness<"u"&&r.push(e.jsx(Ge,{brightness:s["switch:0"].brightness},m())),typeof s["rgbw:0"]?.white<"u"&&r.push(e.jsx(qe,{white:s["rgbw:0"].white},m())),typeof s["switch:0"]?.white<"u"&&r.push(e.jsx(qe,{white:s["switch:0"].white},m())),typeof s["rgbw:0"]?.rgb<"u"){const{rgb:l}=s["rgbw:0"],a=`rgb(${l[0]}, ${l[1]}, ${l[2]})`;r.push(e.jsx(y,{icon:"material-symbols:light-mode",sx:{color:a}},m()))}}else n.method==="NotifyStatus"?o.hasSwitch&&r.push(e.jsx(He,{consume:o.totalPower},m())):n.method==="NotifyEvent"?typeof s?.events<"u"&&r.push(e.jsx(un,{events:s.events},m())):r.push(e.jsx(y,{icon:"ic:sharp-help",sx:{color:"black"}},m()));return r};gn.propTypes={deviceName:d.string.isRequired,wsMessage:d.object.isRequired};const fn=({ts:t})=>e.jsx(P,{variant:"subtitle2",children:Dt(t,"HH:mm")},m());fn.propTypes={ts:d.number.isRequired};const mn=({deviceName:t,wsmessages:n})=>typeof n>"u"?null:Object.keys(n).map(r=>{const o=n[r];return e.jsxs(i.Fragment,{children:[e.jsxs($,{direction:"row",justifyContent:"left",alignItems:"center",spacing:2,children:[typeof o?.params?.ts<"u"&&e.jsx(fn,{ts:o.params.ts},m()),e.jsx(P,{variant:"subtitle2",children:r},m()),e.jsx(gn,{deviceName:t,wsMessage:o},m())]},m()),e.jsx(P,{variant:"caption",children:JSON.stringify(o)},m())]},m())}),Ar=i.memo(mn);mn.propTypes={deviceName:d.string.isRequired,wsmessages:d.object.isRequired};const ue=["#00AB55","#D22B2B","#000000"],bn=({deviceIP:t,deviceOnline:n,scripts:s})=>{if(typeof s>"u"||s==null||typeof s[Symbol.iterator]!="function")s=[{name:"n/a",colors:ue.slice(-1)},{name:"n/a",colors:ue.slice(-1)},{name:"n/a",colors:ue.slice(-1)}];else{s=[...s];for(let r=0;r<=2;r+=1)typeof s[r]>"u"?s.push({name:"n/a",colors:ue.slice(-1)}):s[r].colors=s[r].running&&n?ue.slice(0,1):ue.slice(1,2)}return s.map((r,o)=>e.jsx(i.Fragment,{children:e.jsxs($,{direction:"row",style:{gap:20},useFlexGap:!0,flexWrap:"wrap",children:[e.jsx(Ve,{href:r.id!==0?`http://${t}/#/script/${r.id}`:`http://${t}/#/scripts`,target:"_blank",color:"inherit",underline:"hover",variant:"subtitle2",noWrap:!0,sx:{minWidth:100},children:e.jsx(P,{noWrap:!0,variant:"caption",children:r.name},m())}),e.jsx(st,{colors:r.colors,sx:{pt:"5px"}},m())]},m())},m()))};bn.propTypes={deviceIP:d.string.isRequired,deviceOnline:d.bool.isRequired,scripts:d.array.isRequired};function Nr(t,n){let s=!t.online;if(typeof t.scripts<"u"){let r;Object.values(t.scripts).forEach(o=>{r=n[`script:${o.id}`],o.running!==r.running&&(s=!0,o.running=r.running)})}if(typeof t.switches<"u"){let r;t.switches.forEach((o,l)=>{r=n[`switch:${o.id}`]||n[`rgbw:${o.id}`];const a=typeof o.ts>"u"||n.ts*1e3>o.ts;typeof r<"u"&&a&&(o.output!==r.output&&(s=!0,o.output=r.output,console.log(`Switch ${o.key} of device ${t.cname} output was set to ${o.output}`)),o.brightness!==r.brightness&&(s=!0,o.brightness=r.brightness,console.log(`Switch ${o.key} of device ${t.cname} brightness was set to ${o.brightness}`)),o.white!==r.white&&(s=!0,o.white=r.white,console.log(`Switch ${o.key} of device ${t.cname} white was set to ${o.white}`)),Ct(o.rgb,r.rgb)||(s=!0,o.rgb=r.rgb,console.log(`Switch ${o.key} of device ${t.cname} rgb was set to ${o.rgb}`)))})}return s?{...t}:null}const Lr=Ie(t=>{const{expand:n,...s}=t;return e.jsx(H,{...s})})(({theme:t,expand:n})=>({transform:n?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})})),jn=({shelly:t,type:n})=>{const[s,r]=i.useState(!1),[o,l]=i.useState(t),[a,u]=i.useState(t.scripts),[x,c]=i.useState(t.wsmessages),[f,h]=i.useState(t.kvs),{subscribe:p,unsubscribe:b,send:j}=V(),C=i.useCallback(g=>{const T=g.type,R=g.data.device;switch(T){case"script":u(_=>R.scripts);break;case"kvs":h(_=>R.kvs);break;case"log":u(_=>R.scripts);break;case"ws":{const _=R?.wsmessages?.NotifyFullStatus?.params;if(typeof _<"u"){const S=Nr(o,_);S!==null&&l(F=>S)}c(S=>R.wsmessages);break}default:l(_=>R)}},[o]);i.useEffect(()=>{if(t.gen!==0)return p({subscriptionID:t.id,callback:C,all:!1},["ShellyUpdate"]),()=>{b(t.id,["ShellyUpdate"])}},[t,p,b,C]);const w=()=>{r(!s)},v=g=>{g.ts=Date.now(),j({event:"toggleSwitch",data:{name:"Shelly Device",message:`${t.cname} wants to toggle a switch`,switch:g}})},k=g=>{if(g.ts=Date.now(),typeof g.rgb<"u"&&!(g.rgb instanceof Array)){let T=g.rgb.substring(g.rgb.indexOf("(")+1,g.rgb.indexOf(")")).split(",");T=T.map(R=>Number(R)),g.rgb=T}j({event:"setSwitch",data:{name:"Shelly Device",message:`${t.cname} wants to toggle a switch`,switch:g}})};return e.jsx(le,{raised:!0,children:e.jsxs($,{direction:n==="ctrl"?"column":"row",children:[e.jsxs($,{children:[e.jsx(Dr,{device:o,handleSwitchToggle:v}),n==="sk"&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{sx:{minWidth:200,pt:0},children:e.jsx($,{justifyContent:"left",alignItems:"flex-start",children:e.jsx(bn,{deviceIP:o.ip,deviceOnline:o.online,scripts:a})})}),e.jsxs(Zn,{disableSpacing:!0,children:[e.jsx(H,{href:`http://${o.ip}/#/key-value-store`,target:"_blank","aria-label":"show KVS entries",children:e.jsx(y,{icon:"material-symbols:storage-rounded",sx:{color:o?.kvs?.length===0?"grey":"green"}},m())}),e.jsx(Lr,{disabled:o?.kvs?.length===0,onClick:w,expand:s,"aria-expanded":s,"aria-label":"show KVS entries",children:e.jsx(y,{icon:"mdi:expand-more",sx:{color:"gray"}},m())})]}),e.jsx(Xn,{in:s,timeout:"auto",mountOnEnter:!0,unmountOnExit:!0,children:e.jsx(ke,{sx:{pt:0},children:e.jsx($,{justifyContent:"left",alignItems:"flex-start",children:e.jsx(an,{kvs:f})})})})]})]}),n==="ws"&&e.jsx(ke,{sx:{display:"flex",width:1,overflowX:"auto",overflowY:"auto"},children:e.jsx($,{children:e.jsx(Ar,{deviceName:o.name,wsmessages:x})})}),n==="log"&&e.jsx(ke,{sx:{display:"flex",width:1,overflowX:"auto",overflowY:"auto"},children:e.jsx($,{children:e.jsx(Er,{scripts:a})})}),n==="ctrl"&&e.jsx(O,{bgcolor:"white",sx:{minWidth:220,maxWidth:220,maxHeight:180,minHeight:180,mb:2,pl:2,pr:2},children:e.jsx(ln,{device:o,handleSwitchSet:k})})]})})},Ur=i.memo(jn);jn.propTypes={shelly:d.object.isRequired,type:d.string.isRequired};const _n=({index:t,devices:n})=>{const r=["sk","ctrl","log","ws"][t],o=12,l=r==="sk"||r==="ctrl"?4:12,a=r==="sk"||r==="ctrl"?2:12,u=r==="sk"||r==="ctrl"?2:12,x=r==="sk"||r==="ctrl"?2:12;return e.jsx(X,{container:!0,spacing:2,size:{xs:{xs:o},sm:{sm:l},md:{md:a},lg:{lg:u},xl:{xl:x}},children:n.map(c=>{const f=c.switches.find(j=>typeof j.brightness<"u"),h=c.switches.find(j=>typeof j.white<"u"),p=c.switches.find(j=>typeof j.rgb<"u");return r==="sk"||r==="ws"&&c.gen>0||r==="log"&&c.gen>1||r==="ctrl"&&(f||h||p)?e.jsx(X,{sx:{minWidth:r==="sk"||r==="ctrl"?0:1},children:e.jsx(Ur,{shelly:c,type:r},c.id)},m()):null})})},Br=i.memo(_n);_n.propTypes={index:d.number.isRequired,devices:d.array};const Me=[{value:"config",label:"Config"},{value:"cname",label:"Name"},{value:"name",label:"Model"},{value:"gen",label:"Gen"}];function yn({handleSort:t}){const[n,s]=i.useState(null),[r,o]=i.useState(0),{t:l}=L(),a=c=>{s(c.currentTarget)},u=()=>{s(null)},x=(c,f)=>{s(null),o(f),t(Me[f])};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{disableRipple:!0,color:"inherit",onClick:a,endIcon:e.jsx(y,{icon:n?"eva:chevron-up-fill":"eva:chevron-down-fill"}),children:[l("_sortby_"),":",e.jsx(P,{component:"span",variant:"subtitle2",sx:{color:"text.secondary"},children:l(Me[r].label)})]}),e.jsx(Qn,{open:!!n,anchorEl:n,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},slotProps:{paper:{sx:{[`& .${es.root}`]:{p:0}}}},children:Me.map((c,f)=>e.jsx(W,{onClick:h=>x(h,f),selected:f===r,children:l(c.label)},c.value))})]})}yn.propTypes={handleSort:d.func.isRequired};function Mr({openFilter:t,onOpenFilter:n,onCloseFilter:s,filter:r,handleDeviceFilter:o}){const[l,a]=i.useState([]),[u,x]=i.useState([]),{t:c}=L();if(i.useEffect(()=>{a(Array.from(r.mChecked)),x(Array.from(r.gChecked))},[r]),typeof r>"u")return null;const f=C=>{const w=l.map((v,k)=>k===C?!v:v);a(w)},h=C=>{const w=u.map((v,k)=>k===C?!v:v);x(w)},p=e.jsxs($,{spacing:1,children:[e.jsx(P,{variant:"subtitle2",children:c("Model")}),e.jsx(lt,{children:r.models.map((C,w)=>e.jsx(Te,{control:e.jsx(me,{checked:!!l[w],onChange:()=>f(w)}),label:C},C))})]}),b=e.jsxs($,{spacing:1,children:[e.jsx(P,{variant:"subtitle2",children:c("Generation")}),e.jsx(lt,{children:r.generations.map((C,w)=>e.jsx(Te,{value:C,control:e.jsx(me,{checked:!!u[w],onChange:()=>h(w)}),label:C!==""?`Gen ${C}`:"no Gen"},C))})]}),j=()=>{a(new Array(r.mChecked.length).fill(!1)),x(new Array(r.gChecked.length).fill(!1))};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{disableRipple:!0,color:r.isFilter?"success":"inherit",endIcon:e.jsx(y,{icon:"ic:round-filter-list"}),onClick:n,children:[c("Filters"),""]}),e.jsxs(ae,{anchor:"right",open:t,onClose:s,slotProps:{paper:{sx:{width:300,border:"none",overflow:"hidden"}}},children:[e.jsxs($,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{px:1,py:2},children:[e.jsx(P,{variant:"h6",sx:{ml:1},children:c("Filters")}),e.jsx(H,{onClick:s,children:e.jsx(y,{icon:"eva:close-fill"})})]}),e.jsx(ne,{}),e.jsx(Le,{children:e.jsxs($,{spacing:3,sx:{p:3},children:[p,b]})}),e.jsx(O,{sx:{p:3},children:e.jsxs($,{direction:"row",spacing:2,children:[e.jsx(Y,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(y,{icon:"formkit:submit"}),onClick:C=>o(l,u),children:c("Submit")}),e.jsx(Y,{fullWidth:!0,size:"large",color:"inherit",variant:"outlined",startIcon:e.jsx(y,{icon:"ic:round-clear-all"}),onClick:C=>j(),children:c("Clear")})]})})]})]})}function Wr(){const{devices:t}=V(),[n,s]=i.useState(t),[r,o]=i.useState(!1),[l,a]=i.useState(0),[u,x]=i.useState({models:[],generations:[],mChecked:[],gChecked:[],isFilter:!1}),{t:c}=L();i.useEffect(()=>{if(t.length!==0){const w=[],v=[];t.forEach(g=>{w.includes(g.name)||w.push(g.name),v.includes(g.gen)||v.push(g.gen)});const k={models:w,generations:v,mChecked:new Array(w.length).fill(!1),gChecked:new Array(v.length).fill(!1),isFilter:!1};x(()=>k)}},[t]);const f=(w,v)=>{a(v)},h=()=>{o(!0)},p=()=>{o(!1)},b=w=>{let v;switch(w.value){case"config":s(k=>t);break;case"gen":v=[...n],v=Tr(v,"gen"),s(()=>v);break;default:v=[...n],v=Or(v,w.value),s(()=>v)}},j=w=>t.filter(k=>{for(const g in w)if(k[g]===void 0||!w[g].includes(k[g]))return!1;return!0}),C=(w,v)=>{let k=!1;const g={};u.models.forEach((T,R)=>{w[R]&&(k=!0,typeof g.name>"u"&&(g.name=[]),g.name.push(T))}),u.generations.forEach((T,R)=>{v[R]&&(k=!0,typeof g.gen>"u"&&(g.gen=[]),g.gen.push(T))}),s(k?()=>j(g):()=>t),x({models:u.models,generations:u.generations,mChecked:w,gChecked:v,isFilter:k}),o(!1)};return e.jsxs(he,{children:[e.jsx(tt,{title:"Shellies"}),e.jsx($,{direction:"row",alignItems:"center",flexWrap:"wrap-reverse",justifyContent:"flex-end",sx:{mb:5},children:e.jsxs($,{direction:"row",spacing:1,flexShrink:0,sx:{my:1},children:[e.jsx(Mr,{openFilter:r,onOpenFilter:h,onCloseFilter:p,filter:u,handleDeviceFilter:C}),e.jsx(yn,{handleSort:b})]})}),e.jsx(O,{sx:{pb:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(ts,{value:l,onChange:f,variant:"scrollable",scrollButtons:"auto","aria-label":"shelly tabs",children:[e.jsx($e,{label:"Script / KVS"}),e.jsx($e,{label:c("Control")}),e.jsx($e,{label:"Logs"}),e.jsx($e,{label:"WS Inspector"})]})}),e.jsx(Br,{index:l,devices:typeof n>"u"?t:n},"shelliesTab")]})}function zr(){const{user:t}=V();return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" Shellies"})}),t?e.jsx(Wr,{}):null]})}const qr=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"}));function Hr(){const t=e.jsx(O,{component:"header",sx:{top:0,left:0,width:1,lineHeight:0,position:"fixed",p:n=>({xs:n.spacing(3,3,0),sm:n.spacing(5,5,0)})},children:e.jsx(ye,{sx:{mt:3,ml:4}})});return e.jsxs(e.Fragment,{children:[t,e.jsx(he,{children:e.jsxs(O,{sx:{py:12,maxWidth:480,mx:"auto",display:"flex",minHeight:"100vh",textAlign:"center",alignItems:"center",flexDirection:"column",justifyContent:"center"},children:[e.jsx(P,{variant:"h3",sx:{mb:3},children:"Sorry, page not found!"}),e.jsx(P,{sx:{color:"text.secondary"},children:"Sorry, we couldn뗪 find the page youre looking for. Perhaps you뗬e mistyped the URL? Be sure to check your spelling."}),e.jsx(O,{component:"img",src:"/assets/illustrations/illustration_404.svg",sx:{mx:"auto",height:260,my:{xs:5,sm:10}}}),e.jsx(Y,{href:"/",size:"large",variant:"contained",component:Pt,children:"Go to Home"})]})})]})}function Gr(){return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx("title",{children:" 404 Page Not Found "})}),e.jsx(Hr,{})]})}const Vr=Object.freeze(Object.defineProperty({__proto__:null,default:Gr},Symbol.toStringTag,{value:"Module"}));export{ri as a,si as c,oi as g};
//# sourceMappingURL=index-pfyqZ81J.js.map
