{"version":3,"file":"framesync-BEUTIEb0.js","sources":["../../node_modules/framesync/dist/framesync.cjs.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar defaultTimestep = (1 / 60) * 1000;\nvar getCurrentTime = typeof performance !== \"undefined\"\n    ? function () { return performance.now(); }\n    : function () { return Date.now(); };\nvar onNextFrame = typeof window !== \"undefined\"\n    ? function (callback) {\n        return window.requestAnimationFrame(callback);\n    }\n    : function (callback) {\n        return setTimeout(function () { return callback(getCurrentTime()); }, defaultTimestep);\n    };\n\nfunction createRenderStep(runNextFrame) {\n    var toRun = [];\n    var toRunNextFrame = [];\n    var numToRun = 0;\n    var isProcessing = false;\n    var toKeepAlive = new WeakSet();\n    var step = {\n        schedule: function (callback, keepAlive, immediate) {\n            if (keepAlive === void 0) { keepAlive = false; }\n            if (immediate === void 0) { immediate = false; }\n            var addToCurrentFrame = immediate && isProcessing;\n            var buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n            if (keepAlive)\n                toKeepAlive.add(callback);\n            if (buffer.indexOf(callback) === -1) {\n                buffer.push(callback);\n                if (addToCurrentFrame && isProcessing)\n                    numToRun = toRun.length;\n            }\n            return callback;\n        },\n        cancel: function (callback) {\n            var index = toRunNextFrame.indexOf(callback);\n            if (index !== -1)\n                toRunNextFrame.splice(index, 1);\n            toKeepAlive.delete(callback);\n        },\n        process: function (frameData) {\n            var _a;\n            isProcessing = true;\n            _a = [toRunNextFrame, toRun], toRun = _a[0], toRunNextFrame = _a[1];\n            toRunNextFrame.length = 0;\n            numToRun = toRun.length;\n            if (numToRun) {\n                for (var i = 0; i < numToRun; i++) {\n                    var callback = toRun[i];\n                    callback(frameData);\n                    if (toKeepAlive.has(callback)) {\n                        step.schedule(callback);\n                        runNextFrame();\n                    }\n                }\n            }\n            isProcessing = false;\n        },\n    };\n    return step;\n}\n\nvar maxElapsed = 40;\nvar useDefaultElapsed = true;\nvar runNextFrame = false;\nvar isProcessing = false;\nvar frame = {\n    delta: 0,\n    timestamp: 0,\n};\nvar stepsOrder = [\n    \"read\",\n    \"update\",\n    \"preRender\",\n    \"render\",\n    \"postRender\",\n];\nvar steps = stepsOrder.reduce(function (acc, key) {\n    acc[key] = createRenderStep(function () { return (runNextFrame = true); });\n    return acc;\n}, {});\nvar sync = stepsOrder.reduce(function (acc, key) {\n    var step = steps[key];\n    acc[key] = function (process, keepAlive, immediate) {\n        if (keepAlive === void 0) { keepAlive = false; }\n        if (immediate === void 0) { immediate = false; }\n        if (!runNextFrame)\n            startLoop();\n        return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n}, {});\nvar cancelSync = stepsOrder.reduce(function (acc, key) {\n    acc[key] = steps[key].cancel;\n    return acc;\n}, {});\nvar flushSync = stepsOrder.reduce(function (acc, key) {\n    acc[key] = function () { return steps[key].process(frame); };\n    return acc;\n}, {});\nvar processStep = function (stepId) { return steps[stepId].process(frame); };\nvar processFrame = function (timestamp) {\n    runNextFrame = false;\n    frame.delta = useDefaultElapsed\n        ? defaultTimestep\n        : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n    frame.timestamp = timestamp;\n    isProcessing = true;\n    stepsOrder.forEach(processStep);\n    isProcessing = false;\n    if (runNextFrame) {\n        useDefaultElapsed = false;\n        onNextFrame(processFrame);\n    }\n};\nvar startLoop = function () {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!isProcessing)\n        onNextFrame(processFrame);\n};\nvar getFrameData = function () { return frame; };\n\nexports.cancelSync = cancelSync;\nexports.default = sync;\nexports.flushSync = flushSync;\nexports.getFrameData = getFrameData;\n"],"names":["framesync_cjs","defaultTimestep","getCurrentTime","onNextFrame","callback","createRenderStep","runNextFrame","toRun","toRunNextFrame","numToRun","isProcessing","toKeepAlive","step","keepAlive","immediate","addToCurrentFrame","buffer","index","frameData","_a","i","maxElapsed","useDefaultElapsed","frame","stepsOrder","steps","acc","key","sync","process","startLoop","cancelSync","flushSync","processStep","stepId","processFrame","timestamp","getFrameData"],"mappings":"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","x_google_ignoreList":[0]}