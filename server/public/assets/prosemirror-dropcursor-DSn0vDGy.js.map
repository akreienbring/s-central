{"version":3,"file":"prosemirror-dropcursor-DSn0vDGy.js","sources":["../../node_modules/prosemirror-dropcursor/dist/index.js"],"sourcesContent":["import { Plugin } from 'prosemirror-state';\nimport { dropPoint } from 'prosemirror-transform';\n\n/**\nCreate a plugin that, when added to a ProseMirror instance,\ncauses a decoration to show up at the drop position when something\nis dragged over the editor.\n\nNodes may add a `disableDropCursor` property to their spec to\ncontrol the showing of a drop cursor inside them. This may be a\nboolean or a function, which will be called with a view and a\nposition, and should return a boolean.\n*/\nfunction dropCursor(options = {}) {\n    return new Plugin({\n        view(editorView) { return new DropCursorView(editorView, options); }\n    });\n}\nclass DropCursorView {\n    constructor(editorView, options) {\n        var _a;\n        this.editorView = editorView;\n        this.cursorPos = null;\n        this.element = null;\n        this.timeout = -1;\n        this.width = (_a = options.width) !== null && _a !== void 0 ? _a : 1;\n        this.color = options.color === false ? undefined : (options.color || \"black\");\n        this.class = options.class;\n        this.handlers = [\"dragover\", \"dragend\", \"drop\", \"dragleave\"].map(name => {\n            let handler = (e) => { this[name](e); };\n            editorView.dom.addEventListener(name, handler);\n            return { name, handler };\n        });\n    }\n    destroy() {\n        this.handlers.forEach(({ name, handler }) => this.editorView.dom.removeEventListener(name, handler));\n    }\n    update(editorView, prevState) {\n        if (this.cursorPos != null && prevState.doc != editorView.state.doc) {\n            if (this.cursorPos > editorView.state.doc.content.size)\n                this.setCursor(null);\n            else\n                this.updateOverlay();\n        }\n    }\n    setCursor(pos) {\n        if (pos == this.cursorPos)\n            return;\n        this.cursorPos = pos;\n        if (pos == null) {\n            this.element.parentNode.removeChild(this.element);\n            this.element = null;\n        }\n        else {\n            this.updateOverlay();\n        }\n    }\n    updateOverlay() {\n        let $pos = this.editorView.state.doc.resolve(this.cursorPos);\n        let isBlock = !$pos.parent.inlineContent, rect;\n        let editorDOM = this.editorView.dom, editorRect = editorDOM.getBoundingClientRect();\n        let scaleX = editorRect.width / editorDOM.offsetWidth, scaleY = editorRect.height / editorDOM.offsetHeight;\n        if (isBlock) {\n            let before = $pos.nodeBefore, after = $pos.nodeAfter;\n            if (before || after) {\n                let node = this.editorView.nodeDOM(this.cursorPos - (before ? before.nodeSize : 0));\n                if (node) {\n                    let nodeRect = node.getBoundingClientRect();\n                    let top = before ? nodeRect.bottom : nodeRect.top;\n                    if (before && after)\n                        top = (top + this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top) / 2;\n                    let halfWidth = (this.width / 2) * scaleY;\n                    rect = { left: nodeRect.left, right: nodeRect.right, top: top - halfWidth, bottom: top + halfWidth };\n                }\n            }\n        }\n        if (!rect) {\n            let coords = this.editorView.coordsAtPos(this.cursorPos);\n            let halfWidth = (this.width / 2) * scaleX;\n            rect = { left: coords.left - halfWidth, right: coords.left + halfWidth, top: coords.top, bottom: coords.bottom };\n        }\n        let parent = this.editorView.dom.offsetParent;\n        if (!this.element) {\n            this.element = parent.appendChild(document.createElement(\"div\"));\n            if (this.class)\n                this.element.className = this.class;\n            this.element.style.cssText = \"position: absolute; z-index: 50; pointer-events: none;\";\n            if (this.color) {\n                this.element.style.backgroundColor = this.color;\n            }\n        }\n        this.element.classList.toggle(\"prosemirror-dropcursor-block\", isBlock);\n        this.element.classList.toggle(\"prosemirror-dropcursor-inline\", !isBlock);\n        let parentLeft, parentTop;\n        if (!parent || parent == document.body && getComputedStyle(parent).position == \"static\") {\n            parentLeft = -pageXOffset;\n            parentTop = -pageYOffset;\n        }\n        else {\n            let rect = parent.getBoundingClientRect();\n            let parentScaleX = rect.width / parent.offsetWidth, parentScaleY = rect.height / parent.offsetHeight;\n            parentLeft = rect.left - parent.scrollLeft * parentScaleX;\n            parentTop = rect.top - parent.scrollTop * parentScaleY;\n        }\n        this.element.style.left = (rect.left - parentLeft) / scaleX + \"px\";\n        this.element.style.top = (rect.top - parentTop) / scaleY + \"px\";\n        this.element.style.width = (rect.right - rect.left) / scaleX + \"px\";\n        this.element.style.height = (rect.bottom - rect.top) / scaleY + \"px\";\n    }\n    scheduleRemoval(timeout) {\n        clearTimeout(this.timeout);\n        this.timeout = setTimeout(() => this.setCursor(null), timeout);\n    }\n    dragover(event) {\n        if (!this.editorView.editable)\n            return;\n        let pos = this.editorView.posAtCoords({ left: event.clientX, top: event.clientY });\n        let node = pos && pos.inside >= 0 && this.editorView.state.doc.nodeAt(pos.inside);\n        let disableDropCursor = node && node.type.spec.disableDropCursor;\n        let disabled = typeof disableDropCursor == \"function\"\n            ? disableDropCursor(this.editorView, pos, event)\n            : disableDropCursor;\n        if (pos && !disabled) {\n            let target = pos.pos;\n            if (this.editorView.dragging && this.editorView.dragging.slice) {\n                let point = dropPoint(this.editorView.state.doc, target, this.editorView.dragging.slice);\n                if (point != null)\n                    target = point;\n            }\n            this.setCursor(target);\n            this.scheduleRemoval(5000);\n        }\n    }\n    dragend() {\n        this.scheduleRemoval(20);\n    }\n    drop() {\n        this.scheduleRemoval(20);\n    }\n    dragleave(event) {\n        if (!this.editorView.dom.contains(event.relatedTarget))\n            this.setCursor(null);\n    }\n}\n\nexport { dropCursor };\n"],"names":["dropCursor","options","Plugin","editorView","DropCursorView","_a","name","handler","e","prevState","pos","$pos","isBlock","rect","editorDOM","editorRect","scaleX","scaleY","before","after","node","nodeRect","top","halfWidth","coords","parent","parentLeft","parentTop","parentScaleX","parentScaleY","timeout","event","disableDropCursor","disabled","target","point","dropPoint"],"mappings":"4GAaA,SAASA,EAAWC,EAAU,GAAI,CAC9B,OAAO,IAAIC,EAAO,CACd,KAAKC,EAAY,CAAE,OAAO,IAAIC,EAAeD,EAAYF,CAAO,CAAG,CAC3E,CAAK,CACL,CACA,MAAMG,CAAe,CACjB,YAAYD,EAAYF,EAAS,CAC7B,IAAII,EACJ,KAAK,WAAaF,EAClB,KAAK,UAAY,KACjB,KAAK,QAAU,KACf,KAAK,QAAU,GACf,KAAK,OAASE,EAAKJ,EAAQ,SAAW,MAAQI,IAAO,OAASA,EAAK,EACnE,KAAK,MAAQJ,EAAQ,QAAU,GAAQ,OAAaA,EAAQ,OAAS,QACrE,KAAK,MAAQA,EAAQ,MACrB,KAAK,SAAW,CAAC,WAAY,UAAW,OAAQ,WAAW,EAAE,IAAIK,GAAQ,CACrE,IAAIC,EAAWC,GAAM,CAAE,KAAKF,CAAI,EAAEE,CAAC,CAAG,EACtC,OAAAL,EAAW,IAAI,iBAAiBG,EAAMC,CAAO,EACtC,CAAE,KAAAD,EAAM,QAAAC,CAAO,CAC1B,CAAC,CACL,CACA,SAAU,CACN,KAAK,SAAS,QAAQ,CAAC,CAAE,KAAAD,EAAM,QAAAC,CAAO,IAAO,KAAK,WAAW,IAAI,oBAAoBD,EAAMC,CAAO,CAAC,CACvG,CACA,OAAOJ,EAAYM,EAAW,CACtB,KAAK,WAAa,MAAQA,EAAU,KAAON,EAAW,MAAM,MACxD,KAAK,UAAYA,EAAW,MAAM,IAAI,QAAQ,KAC9C,KAAK,UAAU,IAAI,EAEnB,KAAK,cAAa,EAE9B,CACA,UAAUO,EAAK,CACPA,GAAO,KAAK,YAEhB,KAAK,UAAYA,EACbA,GAAO,MACP,KAAK,QAAQ,WAAW,YAAY,KAAK,OAAO,EAChD,KAAK,QAAU,MAGf,KAAK,cAAa,EAE1B,CACA,eAAgB,CACZ,IAAIC,EAAO,KAAK,WAAW,MAAM,IAAI,QAAQ,KAAK,SAAS,EACvDC,EAAU,CAACD,EAAK,OAAO,cAAeE,EACtCC,EAAY,KAAK,WAAW,IAAKC,EAAaD,EAAU,sBAAqB,EAC7EE,EAASD,EAAW,MAAQD,EAAU,YAAaG,EAASF,EAAW,OAASD,EAAU,aAC9F,GAAIF,EAAS,CACT,IAAIM,EAASP,EAAK,WAAYQ,EAAQR,EAAK,UAC3C,GAAIO,GAAUC,EAAO,CACjB,IAAIC,EAAO,KAAK,WAAW,QAAQ,KAAK,WAAaF,EAASA,EAAO,SAAW,EAAE,EAClF,GAAIE,EAAM,CACN,IAAIC,EAAWD,EAAK,sBAAqB,EACrCE,EAAMJ,EAASG,EAAS,OAASA,EAAS,IAC1CH,GAAUC,IACVG,GAAOA,EAAM,KAAK,WAAW,QAAQ,KAAK,SAAS,EAAE,sBAAqB,EAAG,KAAO,GACxF,IAAIC,EAAa,KAAK,MAAQ,EAAKN,EACnCJ,EAAO,CAAE,KAAMQ,EAAS,KAAM,MAAOA,EAAS,MAAO,IAAKC,EAAMC,EAAW,OAAQD,EAAMC,CAAS,CACtG,CACJ,CACJ,CACA,GAAI,CAACV,EAAM,CACP,IAAIW,EAAS,KAAK,WAAW,YAAY,KAAK,SAAS,EACnDD,EAAa,KAAK,MAAQ,EAAKP,EACnCH,EAAO,CAAE,KAAMW,EAAO,KAAOD,EAAW,MAAOC,EAAO,KAAOD,EAAW,IAAKC,EAAO,IAAK,OAAQA,EAAO,MAAM,CAClH,CACA,IAAIC,EAAS,KAAK,WAAW,IAAI,aAC5B,KAAK,UACN,KAAK,QAAUA,EAAO,YAAY,SAAS,cAAc,KAAK,CAAC,EAC3D,KAAK,QACL,KAAK,QAAQ,UAAY,KAAK,OAClC,KAAK,QAAQ,MAAM,QAAU,yDACzB,KAAK,QACL,KAAK,QAAQ,MAAM,gBAAkB,KAAK,QAGlD,KAAK,QAAQ,UAAU,OAAO,+BAAgCb,CAAO,EACrE,KAAK,QAAQ,UAAU,OAAO,gCAAiC,CAACA,CAAO,EACvE,IAAIc,EAAYC,EAChB,GAAI,CAACF,GAAUA,GAAU,SAAS,MAAQ,iBAAiBA,CAAM,EAAE,UAAY,SAC3EC,EAAa,CAAC,YACdC,EAAY,CAAC,gBAEZ,CACD,IAAId,EAAOY,EAAO,sBAAqB,EACnCG,EAAef,EAAK,MAAQY,EAAO,YAAaI,EAAehB,EAAK,OAASY,EAAO,aACxFC,EAAab,EAAK,KAAOY,EAAO,WAAaG,EAC7CD,EAAYd,EAAK,IAAMY,EAAO,UAAYI,CAC9C,CACA,KAAK,QAAQ,MAAM,MAAQhB,EAAK,KAAOa,GAAcV,EAAS,KAC9D,KAAK,QAAQ,MAAM,KAAOH,EAAK,IAAMc,GAAaV,EAAS,KAC3D,KAAK,QAAQ,MAAM,OAASJ,EAAK,MAAQA,EAAK,MAAQG,EAAS,KAC/D,KAAK,QAAQ,MAAM,QAAUH,EAAK,OAASA,EAAK,KAAOI,EAAS,IACpE,CACA,gBAAgBa,EAAS,CACrB,aAAa,KAAK,OAAO,EACzB,KAAK,QAAU,WAAW,IAAM,KAAK,UAAU,IAAI,EAAGA,CAAO,CACjE,CACA,SAASC,EAAO,CACZ,GAAI,CAAC,KAAK,WAAW,SACjB,OACJ,IAAIrB,EAAM,KAAK,WAAW,YAAY,CAAE,KAAMqB,EAAM,QAAS,IAAKA,EAAM,OAAO,CAAE,EAC7EX,EAAOV,GAAOA,EAAI,QAAU,GAAK,KAAK,WAAW,MAAM,IAAI,OAAOA,EAAI,MAAM,EAC5EsB,EAAoBZ,GAAQA,EAAK,KAAK,KAAK,kBAC3Ca,EAAW,OAAOD,GAAqB,WACrCA,EAAkB,KAAK,WAAYtB,EAAKqB,CAAK,EAC7CC,EACN,GAAItB,GAAO,CAACuB,EAAU,CAClB,IAAIC,EAASxB,EAAI,IACjB,GAAI,KAAK,WAAW,UAAY,KAAK,WAAW,SAAS,MAAO,CAC5D,IAAIyB,EAAQC,EAAU,KAAK,WAAW,MAAM,IAAKF,EAAQ,KAAK,WAAW,SAAS,KAAK,EACnFC,GAAS,OACTD,EAASC,EACjB,CACA,KAAK,UAAUD,CAAM,EACrB,KAAK,gBAAgB,GAAI,CAC7B,CACJ,CACA,SAAU,CACN,KAAK,gBAAgB,EAAE,CAC3B,CACA,MAAO,CACH,KAAK,gBAAgB,EAAE,CAC3B,CACA,UAAUH,EAAO,CACR,KAAK,WAAW,IAAI,SAASA,EAAM,aAAa,GACjD,KAAK,UAAU,IAAI,CAC3B,CACJ","x_google_ignoreList":[0]}